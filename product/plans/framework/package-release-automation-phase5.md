# Package Release Automation – Phase 5 Tool & Workflow Cleanup

## Goals
- Fully retire the legacy shell and Node helpers so the CLI is the sole entry point for package releases.
- Align local tooling (`format-build.sh`, `utilities/local-ci.sh`, `utilities/deploy-seed.sh`) and CI workflows with the new CLI subcommands.
- Document the updated flow and provide repeatable guidance for onboarding additional packages.
- Land the backend package stub so future packages move through the same automation without extra wiring.

## Legacy Tooling Retirement
- Delete `Framework/Scripts/publish.sh`, `Framework/Scripts/bump-version.mjs`, and `Framework/Scripts/assert-version.mjs` once the CLI reaches feature parity. Before removal, add a deprecation notice that points to `framework packages release|publish`.
- Strip script invocations from `utilities/local-ci.sh`, `utilities/deploy-seed.sh`, and any GitHub Actions workflows under `.github/workflows/`. Replace them with the new CLI commands so CI and local flows share identical semantics.
- Update `Docs/how-to/framework-packages.md` and `Docs/how-to/package-synchronization.md` to remove references to the deleted scripts and demonstrate the CLI-first workflow instead.
- Search for residual mentions of the scripts across the repo (`rg 'publish\\.sh'`) and purge or rewrite them to avoid confusing contributors.

## CLI & Automation Updates
- Extend `utilities/format-build.sh` to invoke `dotnet run --project Framework -- packages release --dry-run --all` as a lightweight smoke check. Gate the call behind an environment toggle (e.g., `WEBSTIR_SKIP_PACKAGE_RELEASE=1`) so contributors can defer it in constrained environments.
- Update `utilities/local-ci.sh` and `utilities/deploy-seed.sh` to call `framework packages sync --changed-only` and `framework packages publish --dry-run` instead of shelling out to scripts. Ensure both commands pipe through the shared process runner for consistent logs.
- Align GitHub Actions steps to call the CLI with explicit flags (registry, dry-run, interactive) rather than exporting environment variables implicitly. Capture the CLI JSON summary (if available) as an artifact for auditing.

## Guidance For New Packages
- Add a “New Package Checklist” section to `Docs/how-to/framework-packages.md` that covers manifest layout, npm scripts, test requirements, and how to register the package with the metadata service.
- Document how to opt-in to optional integrations (testing frameworks, alternative registries) using `framework packages configure` once the command exists.
- Provide sample package scaffolding under `Docs/how-to/snippets/package-template` so new packages follow the agreed directory structure and hook scripts.

## Backend Package Stub
- Create a `Framework/Backend` directory with a placeholder `package.json`, `package-lock.json`, and README that explain the stub status. Gate any build or publish actions behind a `disabled` flag in the metadata service.
- Add the backend entry to `Framework/Packaging/framework-packages.json` with `isEnabled: false` (or equivalent) so the CLI learns about the package without attempting to build it.
- Verify the CLI correctly filters disabled packages during discovery, bump, sync, and publish flows. Add a regression test to lock down the behavior.

## Test Cleanup
- Remove or rewrite tests in `Tests` that asserted shell-script behavior. Replace them with coverage for the new CLI surface (`packages bump|sync|release|publish`).
- Update seed workspaces and baselines to exclude artifacts previously generated by the shell scripts (e.g., legacy tarball paths).
- Ensure CI smoke tests call the CLI end-to-end: no-op release, single-package change, multi-package change, and publish dry-run.

## Risks & Mitigations
- **Incomplete script parity** – Track feature parity in a shared checklist. Block script deletion until the CLI covers every path or has an intentional replacement.
- **Breaking external automation** – Communicate script removal timelines to dependent teams. Provide a shim period where scripts emit a clear error directing callers to the CLI.
- **Stub regression** – Guard the backend stub behind metadata flags and tests to ensure it never publishes accidentally.

## Exit Criteria
- All release-related shell/Node scripts are removed or replaced by thin shims that fail fast with CLI guidance.
- CI and local workflows rely exclusively on `framework packages …` subcommands.
- Documentation reflects the new flow and includes onboarding guidance for future packages.
- Backend package stub is present, discoverable by the CLI, and safely disabled by default.
- Test suite no longer references legacy scripts and passes with the new release pipeline.
