"use strict";(self.webpackChunkwebstir_portal=self.webpackChunkwebstir_portal||[]).push([[6175],{7731:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"how-to/pipeline-hooks","title":"Extend Pipelines with Hooks","description":"Webstir exposes optional hook points so you can layer custom logic onto the","source":"@site/docs/how-to/pipeline-hooks.md","sourceDirName":"how-to","slug":"/how-to/pipeline-hooks","permalink":"/docs/how-to/pipeline-hooks","draft":false,"unlisted":false,"editUrl":"https://github.com/webstir-io/webstir-portal/edit/main/docs/how-to/pipeline-hooks.md","tags":[],"version":"current","lastUpdatedAt":1761061153000,"frontMatter":{},"sidebar":"howTo","previous":{"title":"Synchronize Framework Packages","permalink":"/docs/how-to/package-synchronization"},"next":{"title":"Precompressed Assets","permalink":"/docs/how-to/precompression"}}');var s=o(4848),i=o(8453);const r={},c="Extend Pipelines with Hooks",d={},l=[{value:"Create <code>webstir.config.js</code>",id:"create-webstirconfigjs",level:2},{value:"Hook Context",id:"hook-context",level:2},{value:"Reloading During Watch",id:"reloading-during-watch",level:2},{value:"When to Use Hooks",id:"when-to-use-hooks",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"extend-pipelines-with-hooks",children:"Extend Pipelines with Hooks"})}),"\n",(0,s.jsxs)(n.p,{children:["Webstir exposes optional hook points so you can layer custom logic onto the\nfrontend build/publish pipelines without forking the framework packages. Hooks\nrun after the CLI verifies package versions, so they always execute against\nthe pinned dependencies from ",(0,s.jsx)(n.code,{children:"webstir install"}),"."]}),"\n",(0,s.jsxs)(n.h2,{id:"create-webstirconfigjs",children:["Create ",(0,s.jsx)(n.code,{children:"webstir.config.js"})]}),"\n",(0,s.jsxs)(n.p,{children:["Place a ",(0,s.jsx)(n.code,{children:"webstir.config.js"})," file at the workspace root (next to ",(0,s.jsx)(n.code,{children:"package.json"}),").\nExport an object with a ",(0,s.jsx)(n.code,{children:"hooks"})," section\u2014pipeline hooks run before/after the\nentire build, and builder hooks run around specific stages."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// webstir.config.js\nimport fs from 'node:fs/promises';\nimport path from 'node:path';\n\nasync function record(event, context) {\n  const logPath = path.join(context.workspaceRoot, '.webstir', 'pipeline.log');\n  const payload = JSON.stringify({ event, mode: context.mode, builder: context.builderName ?? null });\n  await fs.appendFile(logPath, `${payload}\\n`, 'utf8');\n}\n\nexport default {\n  hooks: {\n    pipeline: {\n      beforeAll: (context) => record('pipeline:start', context),\n      afterAll: (context) => record('pipeline:complete', context)\n    },\n    builders: {\n      // builder names: javascript, css, html, static-assets\n      javascript: {\n        before: (context) => record('javascript:before', context),\n        after: (context) => record('javascript:after', context)\n      },\n      html: (context) => record('html:before', context) // shorthand for before hook\n    }\n  }\n};\n"})}),"\n",(0,s.jsx)(n.p,{children:"Hooks can be a single function or an array. Returning a promise is optional\u2014the\npipeline awaits each handler in order before moving on."}),"\n",(0,s.jsx)(n.h2,{id:"hook-context",children:"Hook Context"}),"\n",(0,s.jsxs)(n.p,{children:["Every handler receives a ",(0,s.jsx)(n.code,{children:"context"})," object:"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Field"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"config"})}),(0,s.jsxs)(n.td,{children:["The resolved ",(0,s.jsx)(n.code,{children:"FrontendConfig"})," with all paths/features."]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"mode"})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"'build'"})," or ",(0,s.jsx)(n.code,{children:"'publish'"}),"."]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"workspaceRoot"})}),(0,s.jsx)(n.td,{children:"Absolute workspace path."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"builderName"})}),(0,s.jsxs)(n.td,{children:["Stage name (",(0,s.jsx)(n.code,{children:"javascript"}),", ",(0,s.jsx)(n.code,{children:"css"}),", ",(0,s.jsx)(n.code,{children:"html"}),", ",(0,s.jsx)(n.code,{children:"static-assets"}),") or ",(0,s.jsx)(n.code,{children:"undefined"})," for pipeline hooks."]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"changedFile"})}),(0,s.jsx)(n.td,{children:"Path supplied by incremental rebuilds, when available."})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:["Use these values to locate files, run additional tooling, or emit diagnostics.\nThrowing from a hook fails the pipeline with a prefixed error message\n(e.g. ",(0,s.jsx)(n.code,{children:"[hook:builder.javascript.before] \u2026"}),")."]}),"\n",(0,s.jsx)(n.h2,{id:"reloading-during-watch",children:"Reloading During Watch"}),"\n",(0,s.jsxs)(n.p,{children:["The frontend worker busts the module cache for ",(0,s.jsx)(n.code,{children:"webstir.config.js"})," during ",(0,s.jsx)(n.code,{children:"build"}),"\nruns, so edits are picked up live while ",(0,s.jsx)(n.code,{children:"webstir watch"})," is running. Publish-mode\nruns reuse the cached module for determinism."]}),"\n",(0,s.jsx)(n.h2,{id:"when-to-use-hooks",children:"When to Use Hooks"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Inject custom preprocessors (e.g. Markdown to HTML) before the HTML builder."}),"\n",(0,s.jsx)(n.li,{children:"Run linters or style checks after CSS transforms."}),"\n",(0,s.jsxs)(n.li,{children:["Copy additional assets into ",(0,s.jsx)(n.code,{children:"build/"})," or ",(0,s.jsx)(n.code,{children:"dist/"})," without duplicating pipeline\ncode."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["If you outgrow hooks, you can still fork the TypeScript packages, but most\nproject-specific tweaks can stay in ",(0,s.jsx)(n.code,{children:"webstir.config.js"})," for easier maintenance."]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},8453:(e,n,o)=>{o.d(n,{R:()=>r,x:()=>c});var t=o(6540);const s={},i=t.createContext(s);function r(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);