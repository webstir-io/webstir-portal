"use strict";(self.webpackChunkwebstir_portal=self.webpackChunkwebstir_portal||[]).push([[6187],{7424:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"reference/templates","title":"Templates","description":"Embedded scaffolding used by the CLI to create projects and generate files. Keeps new apps consistent and zero-config.","source":"@site/docs/reference/templates.md","sourceDirName":"reference","slug":"/reference/templates","permalink":"/docs/reference/templates","draft":false,"unlisted":false,"editUrl":"https://github.com/webstir-io/webstir-portal/edit/main/docs/reference/templates.md","tags":[],"version":"current","lastUpdatedAt":1762915999000,"frontMatter":{},"sidebar":"reference","previous":{"title":"Webstir Frontend Manifest","permalink":"/docs/reference/frontend-manifest"},"next":{"title":"Workflows","permalink":"/docs/reference/workflows"}}');var d=n(4848),r=n(8453);const l={},t="Templates",c={},o=[{value:"Overview",id:"overview",level:2},{value:"Layout",id:"layout",level:2},{value:"Conventions",id:"conventions",level:2},{value:"TypeScript",id:"typescript",level:2},{value:"CSS &amp; Assets",id:"css--assets",level:2},{value:"Client Error Reporting",id:"client-error-reporting",level:2},{value:"Generators",id:"generators",level:2},{value:"add-page",id:"add-page",level:3},{value:"add-test",id:"add-test",level:3},{value:"Backend Template",id:"backend-template",level:2},{value:"Publish Outputs",id:"publish-outputs",level:2},{value:"Customizing Templates",id:"customizing-templates",level:2},{value:"Related Docs",id:"related-docs",level:2}];function a(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",ul:"ul",...(0,r.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(s.header,{children:(0,d.jsx)(s.h1,{id:"templates",children:"Templates"})}),"\n",(0,d.jsx)(s.p,{children:"Embedded scaffolding used by the CLI to create projects and generate files. Keeps new apps consistent and zero-config."}),"\n",(0,d.jsx)(s.h2,{id:"overview",children:"Overview"}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsx)(s.li,{children:"Lives inside the engine and is embedded into the CLI."}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.code,{children:"webstir init"})," lays down a full-stack project by default."]}),"\n",(0,d.jsx)(s.li,{children:"Generators add files in the right place with sensible defaults."}),"\n"]}),"\n",(0,d.jsx)(s.h2,{id:"layout",children:"Layout"}),"\n",(0,d.jsxs)(s.p,{children:["Created by ",(0,d.jsx)(s.code,{children:"webstir init"})," unless you choose client-only or server-only:"]}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:["Frontend: ",(0,d.jsx)(s.code,{children:"src/frontend/"}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:["App shell: ",(0,d.jsx)(s.code,{children:"src/frontend/app/app.html"}),", ",(0,d.jsx)(s.code,{children:"src/frontend/app/*.js|css|png"})," (copied as-is)"]}),"\n",(0,d.jsxs)(s.li,{children:["Pages: ",(0,d.jsx)(s.code,{children:"src/frontend/pages/<page>/index.html|css|ts"})," (seed includes ",(0,d.jsx)(s.code,{children:"home"}),")"]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(s.li,{children:["Backend: ",(0,d.jsx)(s.code,{children:"src/backend/index.ts"})," (Node API server entry)"]}),"\n",(0,d.jsxs)(s.li,{children:["Shared: ",(0,d.jsx)(s.code,{children:"src/shared/**"})," (types/modules used on both sides)"]}),"\n",(0,d.jsxs)(s.li,{children:["Types: ",(0,d.jsx)(s.code,{children:"types/**"})," (ambient ",(0,d.jsx)(s.code,{children:".d.ts"})," and tsconfig support)"]}),"\n",(0,d.jsxs)(s.li,{children:["Tests: ",(0,d.jsx)(s.code,{children:"tests/**"})," (optional; used by ",(0,d.jsx)(s.code,{children:"webstir test"}),")"]}),"\n"]}),"\n",(0,d.jsx)(s.h2,{id:"conventions",children:"Conventions"}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:["Base HTML requires a ",(0,d.jsx)(s.code,{children:"<main>"})," in ",(0,d.jsx)(s.code,{children:"src/frontend/app/app.html"})," for page merge."]}),"\n",(0,d.jsxs)(s.li,{children:["Page folder names must be URL-safe: letters, numbers, ",(0,d.jsx)(s.code,{children:"_"})," and ",(0,d.jsx)(s.code,{children:"-"}),"."]}),"\n",(0,d.jsxs)(s.li,{children:["Each page has ",(0,d.jsx)(s.code,{children:"index.html"}),", ",(0,d.jsx)(s.code,{children:"index.css"}),", ",(0,d.jsx)(s.code,{children:"index.ts"}),"."]}),"\n",(0,d.jsxs)(s.li,{children:["Backend entry is ",(0,d.jsx)(s.code,{children:"src/backend/index.ts"})," and must export an HTTP server."]}),"\n",(0,d.jsxs)(s.li,{children:["For optional app features (like the router), prefer absolute dynamic imports (e.g., ",(0,d.jsx)(s.code,{children:"await import('/app/router.js')"}),"). This avoids relative-path issues between dev (",(0,d.jsx)(s.code,{children:"build/"}),") and publish (",(0,d.jsx)(s.code,{children:"dist/"}),")."]}),"\n"]}),"\n",(0,d.jsx)(s.h2,{id:"typescript",children:"TypeScript"}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:["Uses an embedded ",(0,d.jsx)(s.code,{children:"base.tsconfig.json"})," referenced by template tsconfigs."]}),"\n",(0,d.jsxs)(s.li,{children:["ESM-only; compiled via ",(0,d.jsx)(s.code,{children:"tsc --build"})," in dev and publish."]}),"\n",(0,d.jsxs)(s.li,{children:["Shared code in ",(0,d.jsx)(s.code,{children:"src/shared"})," is compiled for both frontend and backend."]}),"\n",(0,d.jsxs)(s.li,{children:["Dev tsconfig enables ",(0,d.jsx)(s.code,{children:"sourceMap"})," and ",(0,d.jsx)(s.code,{children:"inlineSources"})," for smooth debugging; publish never ships source maps and strips any ",(0,d.jsx)(s.code,{children:"sourceMappingURL"}),"."]}),"\n",(0,d.jsxs)(s.li,{children:["Dynamic imports are not bundled in v1; they load at runtime. Keep paths absolute (e.g., ",(0,d.jsx)(s.code,{children:"/app/..."}),") for assets under ",(0,d.jsx)(s.code,{children:"src/frontend/app/"}),"."]}),"\n"]}),"\n",(0,d.jsx)(s.h2,{id:"css--assets",children:"CSS & Assets"}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsx)(s.li,{children:"Plain CSS by default; optional CSS Modules in publish."}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.code,{children:"@import"})," and asset URLs are resolved; files copied to outputs."]}),"\n",(0,d.jsxs)(s.li,{children:["Place static app assets under ",(0,d.jsx)(s.code,{children:"src/frontend/app/*"}),"."]}),"\n",(0,d.jsxs)(s.li,{children:["Place Images, Fonts, and Media under ",(0,d.jsx)(s.code,{children:"src/frontend/{images|fonts|media}/**"}),"."]}),"\n"]}),"\n",(0,d.jsx)(s.h2,{id:"client-error-reporting",children:"Client Error Reporting"}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:["The base ",(0,d.jsx)(s.code,{children:"app.html"})," includes ",(0,d.jsx)(s.code,{children:"/app/error.js"})," which installs a lightweight client error handler."]}),"\n",(0,d.jsxs)(s.li,{children:["It listens for ",(0,d.jsx)(s.code,{children:"window"})," ",(0,d.jsx)(s.code,{children:"error"})," and ",(0,d.jsx)(s.code,{children:"unhandledrejection"})," and reports to ",(0,d.jsx)(s.code,{children:"POST /client-errors"})," using ",(0,d.jsx)(s.code,{children:"sendBeacon"})," (fallback to ",(0,d.jsx)(s.code,{children:"fetch"}),")."]}),"\n",(0,d.jsxs)(s.li,{children:["Behavior:","\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsx)(s.li,{children:"Throttled: max 1 event/second; capped at 20 per page session."}),"\n",(0,d.jsxs)(s.li,{children:["Deduped: repeats suppressed within 60s using a fingerprint of type|message|file:line",":col","|stack-hash."]}),"\n",(0,d.jsxs)(s.li,{children:["Correlation: includes a client correlation id; server also accepts ",(0,d.jsx)(s.code,{children:"X-Correlation-ID"}),"."]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(s.li,{children:["Override: set ",(0,d.jsx)(s.code,{children:"window.__WEBSTIR_ON_ERROR__ = (event) => { /* custom */ }"})," before errors occur to customize reporting."]}),"\n",(0,d.jsxs)(s.li,{children:["Opt-out: remove the ",(0,d.jsx)(s.code,{children:'<script src="/app/error.js" async><\/script>'})," tag from your ",(0,d.jsx)(s.code,{children:"src/frontend/app/app.html"}),"."]}),"\n"]}),"\n",(0,d.jsx)(s.h2,{id:"generators",children:"Generators"}),"\n",(0,d.jsx)(s.h3,{id:"add-page",children:"add-page"}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:["Command: ",(0,d.jsx)(s.code,{children:"webstir add-page <name>"})]}),"\n",(0,d.jsxs)(s.li,{children:["Delegates to ",(0,d.jsx)(s.code,{children:"webstir-frontend add-page"})," (TypeScript CLI) to scaffold ",(0,d.jsx)(s.code,{children:"index.html|css|ts"}),"."]}),"\n",(0,d.jsxs)(s.li,{children:["Does not modify existing pages or ",(0,d.jsx)(s.code,{children:"app.html"}),"."]}),"\n",(0,d.jsxs)(s.li,{children:["Name normalization: trims, lowercases, replaces spaces with ",(0,d.jsx)(s.code,{children:"-"}),"."]}),"\n"]}),"\n",(0,d.jsx)(s.h3,{id:"add-test",children:"add-test"}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:["Command: ",(0,d.jsx)(s.code,{children:"webstir add-test <name-or-path>"})]}),"\n",(0,d.jsxs)(s.li,{children:["Delegates to ",(0,d.jsx)(s.code,{children:"webstir-testing-add"})," (TypeScript CLI) to create ",(0,d.jsx)(s.code,{children:"<name>.test.ts"})," under the nearest ",(0,d.jsx)(s.code,{children:"tests/"})," directory."]}),"\n",(0,d.jsx)(s.li,{children:"Works for both frontend and backend tests."}),"\n"]}),"\n",(0,d.jsx)(s.h2,{id:"backend-template",children:"Backend Template"}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:["Minimal Node server at ",(0,d.jsx)(s.code,{children:"src/backend/index.ts"}),"."]}),"\n",(0,d.jsxs)(s.li,{children:["Exposes health endpoints (",(0,d.jsx)(s.code,{children:"GET /api/health"})," + ",(0,d.jsx)(s.code,{children:"/healthz"}),") and a readiness probe (",(0,d.jsx)(s.code,{children:"/readyz"}),") that returns the manifest summary."]}),"\n",(0,d.jsxs)(s.li,{children:["Reads ",(0,d.jsx)(s.code,{children:"PORT"})," env var; defaults handled by the CLI dev server proxy in dev."]}),"\n",(0,d.jsxs)(s.li,{children:["Optional auth adapter: set ",(0,d.jsx)(s.code,{children:"AUTH_JWT_SECRET"})," (plus ",(0,d.jsx)(s.code,{children:"AUTH_JWT_ISSUER"})," / ",(0,d.jsx)(s.code,{children:"AUTH_JWT_AUDIENCE"})," and ",(0,d.jsx)(s.code,{children:"AUTH_SERVICE_TOKENS"})," when needed) to enable bearer-token verification and populate ",(0,d.jsx)(s.code,{children:"ctx.auth"})," in module routes."]}),"\n",(0,d.jsxs)(s.li,{children:["Observability: install ",(0,d.jsx)(s.code,{children:"pino"}),", set ",(0,d.jsx)(s.code,{children:"LOG_LEVEL"})," / ",(0,d.jsx)(s.code,{children:"LOG_SERVICE_NAME"}),", and enable metrics via ",(0,d.jsx)(s.code,{children:"METRICS_ENABLED"}),". Every request logs structured JSON and ",(0,d.jsx)(s.code,{children:"/metrics"})," exposes rolling latency/error stats."]}),"\n",(0,d.jsxs)(s.li,{children:["Database & migrations: set ",(0,d.jsx)(s.code,{children:"DATABASE_URL"})," (defaults to SQLite in ",(0,d.jsx)(s.code,{children:"./data/dev.sqlite"}),") and manage schema changes via ",(0,d.jsx)(s.code,{children:"src/backend/db/migrate.ts"})," + ",(0,d.jsx)(s.code,{children:"src/backend/db/migrations/*.ts"}),". Install ",(0,d.jsx)(s.code,{children:"better-sqlite3"})," for the default SQLite flow or ",(0,d.jsx)(s.code,{children:"pg"})," for Postgres, then run ",(0,d.jsx)(s.code,{children:"npx tsx src/backend/db/migrate.ts"}),"."]}),"\n"]}),"\n",(0,d.jsx)(s.h2,{id:"publish-outputs",children:"Publish Outputs"}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:["Per page: ",(0,d.jsx)(s.code,{children:"dist/frontend/pages/<page>/index.html"})]}),"\n",(0,d.jsxs)(s.li,{children:["Fingerprinted assets: ",(0,d.jsx)(s.code,{children:"dist/frontend/pages/<page>/index.<timestamp>.{css|js}"})]}),"\n",(0,d.jsxs)(s.li,{children:["Per-page ",(0,d.jsx)(s.code,{children:"manifest.json"})," listing hashed asset names."]}),"\n",(0,d.jsxs)(s.li,{children:["App assets copied to ",(0,d.jsx)(s.code,{children:"dist/frontend/app/*"}),"."]}),"\n"]}),"\n",(0,d.jsx)(s.h2,{id:"customizing-templates",children:"Customizing Templates"}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:["Edit templates under ",(0,d.jsx)(s.code,{children:"Engine/Templates/"})," in the source."]}),"\n",(0,d.jsxs)(s.li,{children:["Keep conventions intact (page structure, base HTML ",(0,d.jsx)(s.code,{children:"<main>"}),", server entry path)."]}),"\n",(0,d.jsx)(s.li,{children:"After changes, rebuild the CLI to embed updated templates."}),"\n"]}),"\n",(0,d.jsx)(s.h2,{id:"related-docs",children:"Related Docs"}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:["Solution overview \u2014 ",(0,d.jsx)(s.a,{href:"/docs/explanations/solution",children:"solution"})]}),"\n",(0,d.jsxs)(s.li,{children:["CLI reference \u2014 ",(0,d.jsx)(s.a,{href:"/docs/reference/cli",children:"cli"})]}),"\n",(0,d.jsxs)(s.li,{children:["Engine internals \u2014 ",(0,d.jsx)(s.a,{href:"/docs/explanations/engine",children:"engine"})]}),"\n",(0,d.jsxs)(s.li,{children:["Pipelines \u2014 ",(0,d.jsx)(s.a,{href:"/docs/explanations/pipelines",children:"pipelines"})]}),"\n",(0,d.jsxs)(s.li,{children:["Workspace and paths \u2014 ",(0,d.jsx)(s.a,{href:"/docs/explanations/workspace",children:"workspace"})]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,d.jsx)(s,{...e,children:(0,d.jsx)(a,{...e})}):a(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>l,x:()=>t});var i=n(6540);const d={},r=i.createContext(d);function l(e){const s=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:l(e.components),i.createElement(r.Provider,{value:s},e.children)}}}]);