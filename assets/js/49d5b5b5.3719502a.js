"use strict";(self.webpackChunkwebstir_portal=self.webpackChunkwebstir_portal||[]).push([[959],{4865:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>a,frontMatter:()=>l,metadata:()=>i,toc:()=>t});const i=JSON.parse('{"id":"how-to/sandbox","title":"Sandbox","description":"Run a published Webstir app behind nginx with the template API server via Docker Compose. Use this to validate dist/ outputs and production routing without the dev server.","source":"@site/docs/how-to/sandbox.md","sourceDirName":"how-to","slug":"/how-to/sandbox","permalink":"/docs/how-to/sandbox","draft":false,"unlisted":false,"editUrl":"https://github.com/webstir-io/webstir-portal/edit/main/docs/how-to/sandbox.md","tags":[],"version":"current","lastUpdatedAt":1761061153000,"frontMatter":{},"sidebar":"howTo","previous":{"title":"Publish","permalink":"/docs/how-to/publish"},"next":{"title":"Package Template Snippet","permalink":"/docs/how-to/snippets/package-template/"}}');var d=s(4848),o=s(8453);const l={},r="Sandbox",c={},t=[{value:"Overview",id:"overview",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Usage",id:"usage",level:2},{value:"Volumes &amp; Paths",id:"volumes--paths",level:2},{value:"Nginx Behavior",id:"nginx-behavior",level:2},{value:"Environment",id:"environment",level:2},{value:"Expected Dist Layout",id:"expected-dist-layout",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Related Docs",id:"related-docs",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",ul:"ul",...(0,o.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"sandbox",children:"Sandbox"})}),"\n",(0,d.jsxs)(n.p,{children:["Run a published Webstir app behind nginx with the template API server via Docker Compose. Use this to validate ",(0,d.jsx)(n.code,{children:"dist/"})," outputs and production routing without the dev server."]}),"\n",(0,d.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Two containers: ",(0,d.jsx)(n.code,{children:"web"})," (nginx) and ",(0,d.jsx)(n.code,{children:"api"})," (Node server)."]}),"\n",(0,d.jsxs)(n.li,{children:["Clean URLs: nginx maps ",(0,d.jsx)(n.code,{children:"/about"})," \u2192 ",(0,d.jsx)(n.code,{children:"/pages/about/index.html"})," and page assets."]}),"\n",(0,d.jsxs)(n.li,{children:["API proxy: browser calls ",(0,d.jsx)(n.code,{children:"http://localhost:8000"})," directly to the API container."]}),"\n",(0,d.jsx)(n.li,{children:"Volumes mount published assets from your local build."}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"Files:"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Compose \u2014 ",(0,d.jsx)(n.code,{children:"Sandbox/docker-compose.yml"})]}),"\n",(0,d.jsxs)(n.li,{children:["nginx site config \u2014 ",(0,d.jsx)(n.code,{children:"Sandbox/web/nginx.conf"})]}),"\n",(0,d.jsxs)(n.li,{children:["nginx main config (loads Brotli modules) \u2014 ",(0,d.jsx)(n.code,{children:"Sandbox/web/nginx.main.conf"})]}),"\n",(0,d.jsxs)(n.li,{children:["custom nginx image (builds ",(0,d.jsx)(n.code,{children:"ngx_brotli"}),") \u2014 ",(0,d.jsx)(n.code,{children:"Sandbox/web/Dockerfile"})]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Docker and Docker Compose installed."}),"\n",(0,d.jsxs)(n.li,{children:["Published frontend and compiled backend available locally:","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Frontend: ",(0,d.jsx)(n.code,{children:"dist/frontend/**"})," (from ",(0,d.jsx)(n.code,{children:"webstir publish"}),")"]}),"\n",(0,d.jsxs)(n.li,{children:["Backend: ",(0,d.jsx)(n.code,{children:"build/backend/index.js"})," (from ",(0,d.jsx)(n.code,{children:"webstir build"})," or ",(0,d.jsx)(n.code,{children:"watch"}),")"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["The provided compose mounts a seed output under ",(0,d.jsx)(n.code,{children:"../CLI/out/seed/..."}),". Swap to your project paths as needed."]}),"\n",(0,d.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["From ",(0,d.jsx)(n.code,{children:"Sandbox/"})," run: ",(0,d.jsx)(n.code,{children:"docker compose up --build -d"})]}),"\n",(0,d.jsxs)(n.li,{children:["Open: ",(0,d.jsx)(n.code,{children:"http://localhost:8080"})," (web) and ",(0,d.jsx)(n.code,{children:"http://localhost:8000"})," (api)"]}),"\n",(0,d.jsxs)(n.li,{children:["Logs: ",(0,d.jsx)(n.code,{children:"docker compose logs -f web"})," or ",(0,d.jsx)(n.code,{children:"docker compose logs -f api"})]}),"\n",(0,d.jsxs)(n.li,{children:["Stop: ",(0,d.jsx)(n.code,{children:"docker compose down"})]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"volumes--paths",children:"Volumes & Paths"}),"\n",(0,d.jsx)(n.p,{children:"Default mounts (see compose):"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Web root: ",(0,d.jsx)(n.code,{children:"../CLI/out/seed/dist/frontend"})," \u2192 ",(0,d.jsx)(n.code,{children:"/usr/share/nginx/html"})]}),"\n",(0,d.jsxs)(n.li,{children:["App assets: ",(0,d.jsx)(n.code,{children:"../CLI/out/seed/dist/frontend/app"})," \u2192 ",(0,d.jsx)(n.code,{children:"/usr/share/nginx/html/app"})]}),"\n",(0,d.jsxs)(n.li,{children:["API app root: ",(0,d.jsx)(n.code,{children:"../CLI/out/seed"})," \u2192 ",(0,d.jsx)(n.code,{children:"/app"})," (runs ",(0,d.jsx)(n.code,{children:"build/backend/index.js"}),")"]}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["To use your project, point volumes at your project\u2019s ",(0,d.jsx)(n.code,{children:"dist/frontend"})," and built backend directory."]}),"\n",(0,d.jsx)(n.h2,{id:"nginx-behavior",children:"Nginx Behavior"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Clean URLs: ",(0,d.jsx)(n.code,{children:"/"})," serves ",(0,d.jsx)(n.code,{children:"pages/home/index.html"}),"; ",(0,d.jsx)(n.code,{children:"/about"})," serves ",(0,d.jsx)(n.code,{children:"pages/about/index.html"}),"."]}),"\n",(0,d.jsxs)(n.li,{children:["Page assets: ",(0,d.jsx)(n.code,{children:"/index.*.(css|js)"})," map to ",(0,d.jsx)(n.code,{children:"pages/home/*"}),"; ",(0,d.jsx)(n.code,{children:"/about/*"})," map to ",(0,d.jsx)(n.code,{children:"pages/about/*"}),"."]}),"\n",(0,d.jsxs)(n.li,{children:["Hashed assets: content\u2011hashed filenames receive ",(0,d.jsx)(n.code,{children:"Cache-Control: public, max-age=31536000, immutable"}),"."]}),"\n",(0,d.jsxs)(n.li,{children:["HTML: ",(0,d.jsx)(n.code,{children:"no-cache, no-store, must-revalidate"}),"."]}),"\n",(0,d.jsxs)(n.li,{children:["Compression: dynamic Brotli/gzip enabled; also serves precompressed ",(0,d.jsx)(n.code,{children:".br"})," when present."]}),"\n",(0,d.jsx)(n.li,{children:"Security headers: CSP and standard security headers are set."}),"\n",(0,d.jsx)(n.li,{children:"Source maps: blocked in sandbox (404) to mirror production policy."}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"environment",children:"Environment"}),"\n",(0,d.jsx)(n.p,{children:"API container env (edit in compose if needed):"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.code,{children:"PORT=8000"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.code,{children:"WEB_SERVER_URL=http://web"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.code,{children:"API_SERVER_URL=http://api:8000"})}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"expected-dist-layout",children:"Expected Dist Layout"}),"\n",(0,d.jsxs)(n.p,{children:["Produced by ",(0,d.jsx)(n.code,{children:"webstir publish"})," (content\u2011hash fingerprinting):"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.code,{children:"dist/frontend/pages/<page>/index.html"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.code,{children:"dist/frontend/pages/<page>/index.<hash>.css"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.code,{children:"dist/frontend/pages/<page>/index.<hash>.js"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.code,{children:"dist/frontend/pages/<page>/manifest.json"})}),"\n",(0,d.jsxs)(n.li,{children:["Shared app assets under ",(0,d.jsx)(n.code,{children:"dist/frontend/app/*"})]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["404s for pages: ensure ",(0,d.jsx)(n.code,{children:"dist/frontend/pages/<page>/index.html"})," exists and volumes point to the correct ",(0,d.jsx)(n.code,{children:"dist"})," path."]}),"\n",(0,d.jsx)(n.li,{children:"404s for assets: verify fingerprinted files exist and nginx mapping matches page name."}),"\n",(0,d.jsxs)(n.li,{children:["API not reachable: check ",(0,d.jsx)(n.code,{children:"api"})," logs and that ",(0,d.jsx)(n.code,{children:"build/backend/index.js"})," exists in the mounted directory."]}),"\n",(0,d.jsx)(n.li,{children:"Caching issues: hard refresh; nginx caches static assets for 7 days by default."}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"related-docs",children:"Related Docs"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Solution overview \u2014 ",(0,d.jsx)(n.a,{href:"/docs/explanations/solution",children:"solution"})]}),"\n",(0,d.jsxs)(n.li,{children:["CLI reference \u2014 ",(0,d.jsx)(n.a,{href:"/docs/reference/cli",children:"cli"})]}),"\n",(0,d.jsxs)(n.li,{children:["Engine internals \u2014 ",(0,d.jsx)(n.a,{href:"/docs/explanations/engine",children:"engine"})]}),"\n",(0,d.jsxs)(n.li,{children:["Pipelines (publish details) \u2014 ",(0,d.jsx)(n.a,{href:"/docs/explanations/pipelines",children:"pipelines"})]}),"\n",(0,d.jsxs)(n.li,{children:["Tests (publish E2E) \u2014 ",(0,d.jsx)(n.a,{href:"/docs/explanations/testing",children:"tests"})]}),"\n"]})]})}function a(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(h,{...e})}):h(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>r});var i=s(6540);const d={},o=i.createContext(d);function l(e){const n=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:l(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);