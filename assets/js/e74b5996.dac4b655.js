"use strict";(self.webpackChunkwebstir_portal=self.webpackChunkwebstir_portal||[]).push([[1438],{2094:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>t,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"reference/contracts","title":"Contracts & Invariants","description":"Public, user-visible guarantees that Webstir preserves across releases. These are validated by end-to-end tests and serve as the stable contract between the CLI and projects.","source":"@site/docs/reference/contracts.md","sourceDirName":"reference","slug":"/reference/contracts","permalink":"/docs/reference/contracts","draft":false,"unlisted":false,"editUrl":"https://github.com/webstir-io/webstir-portal/edit/main/docs/reference/contracts.md","tags":[],"version":"current","lastUpdatedAt":1764454564000,"frontMatter":{},"sidebar":"reference","previous":{"title":"CLI","permalink":"/docs/reference/cli"},"next":{"title":"Webstir Frontend Manifest","permalink":"/docs/reference/frontend-manifest"}}');var i=n(4848),d=n(8453);const c={},t="Contracts & Invariants",l={},o=[{value:"Source Layout",id:"source-layout",level:2},{value:"Dev Outputs",id:"dev-outputs",level:2},{value:"Publish Outputs",id:"publish-outputs",level:2},{value:"HTML Composition",id:"html-composition",level:2},{value:"JavaScript/TypeScript",id:"javascripttypescript",level:2},{value:"CSS",id:"css",level:2},{value:"Dev Server",id:"dev-server",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"CLI Guarantees",id:"cli-guarantees",level:2}];function a(e){const s={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",ul:"ul",...(0,d.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"contracts--invariants",children:"Contracts & Invariants"})}),"\n",(0,i.jsx)(s.p,{children:"Public, user-visible guarantees that Webstir preserves across releases. These are validated by end-to-end tests and serve as the stable contract between the CLI and projects."}),"\n",(0,i.jsx)(s.h2,{id:"source-layout",children:"Source Layout"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Frontend: ",(0,i.jsx)(s.code,{children:"src/frontend/**"})]}),"\n",(0,i.jsxs)(s.li,{children:["Pages: ",(0,i.jsx)(s.code,{children:"src/frontend/pages/<page>/index.html|css|ts"})]}),"\n",(0,i.jsxs)(s.li,{children:["App assets: ",(0,i.jsx)(s.code,{children:"src/frontend/app/**"})]}),"\n",(0,i.jsxs)(s.li,{children:["Static assets: ",(0,i.jsx)(s.code,{children:"src/frontend/{images|fonts|media}/**"})]}),"\n",(0,i.jsxs)(s.li,{children:["Backend: ",(0,i.jsx)(s.code,{children:"src/backend/**"})," (entry: ",(0,i.jsx)(s.code,{children:"src/backend/index.ts"}),")"]}),"\n",(0,i.jsxs)(s.li,{children:["Shared: ",(0,i.jsx)(s.code,{children:"src/shared/**"})]}),"\n",(0,i.jsxs)(s.li,{children:["Types: ",(0,i.jsx)(s.code,{children:"types/**"})]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"dev-outputs",children:"Dev Outputs"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"build/frontend/**"})," (includes ",(0,i.jsx)(s.code,{children:"pages"}),", ",(0,i.jsx)(s.code,{children:"images"}),", ",(0,i.jsx)(s.code,{children:"fonts"}),", ",(0,i.jsx)(s.code,{children:"media"}),")"]}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"build/backend/**"})}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"publish-outputs",children:"Publish Outputs"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Per page under ",(0,i.jsx)(s.code,{children:"dist/frontend/pages/<page>/"}),":","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"index.html"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"index.<timestamp>.css"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"index.<timestamp>.js"})}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"manifest.json"})," (lists fingerprinted asset names)"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Static assets under ",(0,i.jsx)(s.code,{children:"dist/frontend/{images|fonts|media}/**"})]}),"\n",(0,i.jsxs)(s.li,{children:["App assets under ",(0,i.jsx)(s.code,{children:"dist/frontend/app/**"})]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"html-composition",children:"HTML Composition"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Base HTML at ",(0,i.jsx)(s.code,{children:"src/frontend/app/app.html"})," must contain a ",(0,i.jsx)(s.code,{children:"<main>"})," where page HTML is merged."]}),"\n",(0,i.jsxs)(s.li,{children:["Clean URLs in dev: ",(0,i.jsx)(s.code,{children:"/about"})," serves ",(0,i.jsx)(s.code,{children:"/pages/about/index.html"}),"."]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"javascripttypescript",children:"JavaScript/TypeScript"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"ESM-only module graph; CommonJS is not supported."}),"\n",(0,i.jsxs)(s.li,{children:["Compiled via ",(0,i.jsx)(s.code,{children:"tsc --build"})," using the embedded base ",(0,i.jsx)(s.code,{children:"tsconfig"}),"."]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"css",children:"CSS"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Resolves ",(0,i.jsx)(s.code,{children:"@import"})," and asset URLs in dev."]}),"\n",(0,i.jsxs)(s.li,{children:["Publish minification/prefixing (modern-only): preserves strings/urls and license comments; trims whitespace and trailing ",(0,i.jsx)(s.code,{children:";"}),"; normalizes numbers/zeros; collapses zero shorthands; shortens hex (",(0,i.jsx)(s.code,{children:"#rrggbb\u2192#rgb"}),", ",(0,i.jsx)(s.code,{children:"#rrggbbaa\u2192#rgba"}),"); strips legacy prefixes/values (",(0,i.jsx)(s.code,{children:"-ms-*"}),", ",(0,i.jsx)(s.code,{children:"-o-*"}),", ",(0,i.jsx)(s.code,{children:"-khtml-*"}),", legacy flexbox); adds minimal ",(0,i.jsx)(s.code,{children:"-webkit-"})," where needed."]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"dev-server",children:"Dev Server"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Serves ",(0,i.jsx)(s.code,{children:"build/frontend/**"})," with SSE reload and an ",(0,i.jsx)(s.code,{children:"/api/*"})," proxy to the Node server."]}),"\n",(0,i.jsx)(s.li,{children:"No-cache headers for HTML; short/no-cache for static assets in dev."}),"\n",(0,i.jsxs)(s.li,{children:["Accepts client error reports at ",(0,i.jsx)(s.code,{children:"POST /client-errors"}),":","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Requires ",(0,i.jsx)(s.code,{children:"Content-Type: application/json"})," and body up to 32KB."]}),"\n",(0,i.jsxs)(s.li,{children:["Returns ",(0,i.jsx)(s.code,{children:"204"})," on success; ",(0,i.jsx)(s.code,{children:"415"})," for unsupported media type; ",(0,i.jsx)(s.code,{children:"413"})," if payload too large."]}),"\n",(0,i.jsxs)(s.li,{children:["Forwards to the error tracking hook with correlation id support (",(0,i.jsx)(s.code,{children:"X-Correlation-ID"})," or payload ",(0,i.jsx)(s.code,{children:"correlationId"}),")."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Missing required inputs (base HTML, server entry) fails fast with clear messages."}),"\n",(0,i.jsx)(s.li,{children:"Publish removes comments and source maps from outputs."}),"\n",(0,i.jsxs)(s.li,{children:["Template includes a client error handler (",(0,i.jsx)(s.code,{children:"/app/error.js"}),") that throttles to 1/sec (max 20/session) and deduplicates repeats for 60s."]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"cli-guarantees",children:"CLI Guarantees"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Commands: ",(0,i.jsx)(s.code,{children:"init"}),", ",(0,i.jsx)(s.code,{children:"build"}),", ",(0,i.jsx)(s.code,{children:"watch"}),", ",(0,i.jsx)(s.code,{children:"test"}),", ",(0,i.jsx)(s.code,{children:"publish"}),", ",(0,i.jsx)(s.code,{children:"add-page"}),", ",(0,i.jsx)(s.code,{children:"add-test"}),", ",(0,i.jsx)(s.code,{children:"help"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:["Default command: ",(0,i.jsx)(s.code,{children:"watch"})," when no command is provided."]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,d.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>c,x:()=>t});var r=n(6540);const i={},d=r.createContext(i);function c(e){const s=r.useContext(d);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),r.createElement(d.Provider,{value:s},e.children)}}}]);