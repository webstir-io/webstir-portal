"use strict";(self.webpackChunkwebstir_portal=self.webpackChunkwebstir_portal||[]).push([[9211],{7110:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>t,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"how-to/package-synchronization","title":"Synchronize Framework Packages","description":"This guide covers the end-to-end workflow for rebuilding and publishing the framework packages that Webstir workspaces consume.","source":"@site/docs/how-to/package-synchronization.md","sourceDirName":"how-to","slug":"/how-to/package-synchronization","permalink":"/docs/how-to/package-synchronization","draft":false,"unlisted":false,"editUrl":"https://github.com/webstir-io/webstir-portal/edit/main/docs/how-to/package-synchronization.md","tags":[],"version":"current","lastUpdatedAt":1761532142000,"frontMatter":{},"sidebar":"howTo","previous":{"title":"Init","permalink":"/docs/how-to/init"},"next":{"title":"Extend Pipelines with Hooks","permalink":"/docs/how-to/pipeline-hooks"}}');var i=r(4848),a=r(8453);const c={},o="Synchronize Framework Packages",t={},d=[{value:"Overview",id:"overview",level:2},{value:"Update The Packages",id:"update-the-packages",level:2},{value:"Install In A Workspace",id:"install-in-a-workspace",level:2},{value:"Registry Requirements",id:"registry-requirements",level:2},{value:"Verify Changes",id:"verify-changes",level:2}];function l(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"synchronize-framework-packages",children:"Synchronize Framework Packages"})}),"\n",(0,i.jsx)(n.p,{children:"This guide covers the end-to-end workflow for rebuilding and publishing the framework packages that Webstir workspaces consume."}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Run commands via ",(0,i.jsx)(n.code,{children:"dotnet run --project Framework/Framework.csproj -- packages \u2026"})," from the repo root (or use a built ",(0,i.jsx)(n.code,{children:"framework"})," binary)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Framework/Frontend"}),", ",(0,i.jsx)(n.code,{children:"Framework/Backend"}),", and ",(0,i.jsx)(n.code,{children:"Framework/Testing"})," contain the sources for the published packages."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"framework packages sync"})," rebuilds those packages, updates ",(0,i.jsx)(n.code,{children:"Framework/Packaging/framework-packages.json"}),", and refreshes ",(0,i.jsx)(n.code,{children:"Engine/Resources/package.json"})," with caret specifiers."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"webstir install"})," keeps consuming workspaces aligned with the recorded registry versions by updating ",(0,i.jsx)(n.code,{children:"package.json"})," specifiers and running the configured package manager (pnpm by default) when drift is detected."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"update-the-packages",children:"Update The Packages"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Run ",(0,i.jsx)(n.code,{children:"framework packages bump"})," (for example, ",(0,i.jsx)(n.code,{children:"framework packages bump --bump minor"})," or ",(0,i.jsx)(n.code,{children:"framework packages bump --set-version 1.2.3"}),"). Add ",(0,i.jsx)(n.code,{children:"--dry-run"})," to preview the next version without touching manifests."]}),"\n",(0,i.jsxs)(n.li,{children:["(Optional) Run ",(0,i.jsx)(n.code,{children:"framework packages diff"})," to preview version or specifier drift without modifying files."]}),"\n",(0,i.jsxs)(n.li,{children:["Run ",(0,i.jsx)(n.code,{children:"framework packages sync"}),".","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Add ",(0,i.jsx)(n.code,{children:"--frontend"}),", ",(0,i.jsx)(n.code,{children:"--testing"}),", or ",(0,i.jsx)(n.code,{children:"--backend"})," to rebuild a single package when only one changed."]}),"\n",(0,i.jsxs)(n.li,{children:["The command runs the workspace package manager install (",(0,i.jsx)(n.code,{children:"pnpm install --frozen-lockfile"})," by default) and ",(0,i.jsx)(n.code,{children:"npm run build"}),", then rewrites the manifest and template dependencies with the new versions and caret specifiers. No tarballs are generated."]}),"\n",(0,i.jsxs)(n.li,{children:["Set ",(0,i.jsx)(n.code,{children:"WEBSTIR_FRONTEND_REGISTRY_SPEC"}),", ",(0,i.jsx)(n.code,{children:"WEBSTIR_TEST_REGISTRY_SPEC"}),", or ",(0,i.jsx)(n.code,{children:"WEBSTIR_BACKEND_REGISTRY_SPEC"})," before running if you need an alternate registry specifier (for example, a dist-tag)."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Run ",(0,i.jsx)(n.code,{children:"framework packages verify"}),".","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"The verifier ensures package directories, manifest entries, template dependencies, and the repository state are aligned."}),"\n",(0,i.jsx)(n.li,{children:"The check also confirms that no legacy tarball assets remain in the repo."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["When you are ready to publish the new versions, run ",(0,i.jsx)(n.code,{children:"framework packages publish"}),".","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Publishing pushes each package to the configured registry (GitHub Packages by default) if that version is missing. Export ",(0,i.jsx)(n.code,{children:"GH_PACKAGES_TOKEN"})," so npm can authenticate."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Commit the updated package sources, lockfiles, ",(0,i.jsx)(n.code,{children:"Framework/Packaging/framework-packages.json"}),", and ",(0,i.jsx)(n.code,{children:"Engine/Resources/package.json"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"install-in-a-workspace",children:"Install In A Workspace"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Run ",(0,i.jsx)(n.code,{children:"webstir install"})," (or any workflow that indirectly calls it) in the consuming project."]}),"\n",(0,i.jsxs)(n.li,{children:["The installer rewrites the framework package entries in ",(0,i.jsx)(n.code,{children:"package.json"}),", clears stale caches when necessary, and runs the selected package manager so ",(0,i.jsx)(n.code,{children:"node_modules"})," matches the recorded registry versions."]}),"\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:"webstir install --dry-run"})," to see what would change before reinstalling dependencies."]}),"\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:"webstir install --clean"})," to delete the cached ",(0,i.jsx)(n.code,{children:".webstir/"})," directory before reinstalling."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"registry-requirements",children:"Registry Requirements"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Framework installations now rely on registry packages. Configure ",(0,i.jsx)(n.code,{children:".npmrc"})," with the appropriate registry URL and credentials (currently GitHub Packages via ",(0,i.jsx)(n.code,{children:"GH_PACKAGES_TOKEN"}),"). Corepack users should run ",(0,i.jsx)(n.code,{children:"corepack enable"})," so pnpm is available."]}),"\n",(0,i.jsxs)(n.li,{children:["Provide the token and ",(0,i.jsx)(n.code,{children:".npmrc"})," to CI or sandbox environments before executing ",(0,i.jsx)(n.code,{children:"framework packages publish"})," or ",(0,i.jsx)(n.code,{children:"webstir install"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"verify-changes",children:"Verify Changes"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Run ",(0,i.jsx)(n.code,{children:"./utilities/scripts/format-build.sh"})," before handing off; it formats code, builds the solution, and executes frontend package tests."]}),"\n",(0,i.jsxs)(n.li,{children:["Run ",(0,i.jsx)(n.code,{children:"framework packages sync"})," followed by ",(0,i.jsx)(n.code,{children:"framework packages verify"})," whenever package artifacts change. Use ",(0,i.jsx)(n.code,{children:"framework packages publish --dry-run"})," to exercise the end-to-end pipeline without modifying files."]}),"\n",(0,i.jsxs)(n.li,{children:["Optionally run ",(0,i.jsx)(n.code,{children:"framework packages publish"})," in a dry environment (or CI) to confirm the registry accepts the new version."]}),"\n",(0,i.jsxs)(n.li,{children:["Exercise ",(0,i.jsx)(n.code,{children:"webstir install"})," (optionally with ",(0,i.jsx)(n.code,{children:"--clean"}),") inside a sample workspace to verify the new packages resolve correctly and upgrade existing installations."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>c,x:()=>o});var s=r(6540);const i={},a=s.createContext(i);function c(e){const n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);