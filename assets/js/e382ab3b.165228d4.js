"use strict";(self.webpackChunkwebstir_portal=self.webpackChunkwebstir_portal||[]).push([[5975],{7046:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>t});const i=JSON.parse('{"id":"reference/workflows","title":"Workflows","description":"End-to-end flows driven by the CLI. Workflows coordinate workers, pipelines, and services to deliver a complete task (init \u2192 build \u2192 watch/test \u2192 publish). They are orchestration only; low-level logic lives in engine components.","source":"@site/docs/reference/workflows.md","sourceDirName":"reference","slug":"/reference/workflows","permalink":"/docs/reference/workflows","draft":false,"unlisted":false,"editUrl":"https://github.com/webstir-io/webstir-portal/edit/main/docs/reference/workflows.md","tags":[],"version":"current","lastUpdatedAt":1764454564000,"frontMatter":{},"sidebar":"reference","previous":{"title":"Templates","permalink":"/docs/reference/templates"}}');var r=n(4848),d=n(8453);const l={},o="Workflows",c={},t=[{value:"What They Are",id:"what-they-are",level:2},{value:"Workflow Docs",id:"workflow-docs",level:2},{value:"How They Fit In",id:"how-they-fit-in",level:2},{value:"Workers &amp; DI",id:"workers--di",level:3},{value:"Initiation",id:"initiation",level:2},{value:"Responsibilities",id:"responsibilities",level:2},{value:"Lifecycle (By Workflow)",id:"lifecycle-by-workflow",level:2},{value:"init",id:"init",level:3},{value:"build",id:"build",level:3},{value:"watch",id:"watch",level:3},{value:"test",id:"test",level:3},{value:"publish",id:"publish",level:3},{value:"generators",id:"generators",level:3},{value:"Contracts &amp; Guarantees",id:"contracts--guarantees",level:2},{value:"Errors &amp; Exit Codes",id:"errors--exit-codes",level:2},{value:"Adding a New Workflow",id:"adding-a-new-workflow",level:2},{value:"Related Docs",id:"related-docs",level:2}];function a(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",strong:"strong",ul:"ul",...(0,d.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"workflows",children:"Workflows"})}),"\n",(0,r.jsx)(s.p,{children:"End-to-end flows driven by the CLI. Workflows coordinate workers, pipelines, and services to deliver a complete task (init \u2192 build \u2192 watch/test \u2192 publish). They are orchestration only; low-level logic lives in engine components."}),"\n",(0,r.jsx)(s.h2,{id:"what-they-are",children:"What They Are"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Thin coordinators that call workers and services in a defined order."}),"\n",(0,r.jsx)(s.li,{children:"Source of truth for user-visible behavior, exit codes, and logs."}),"\n",(0,r.jsx)(s.li,{children:"Deterministic: same inputs produce the same outputs."}),"\n",(0,r.jsxs)(s.li,{children:["Composable: some workflows run others (e.g., ",(0,r.jsx)(s.code,{children:"watch"})," runs ",(0,r.jsx)(s.code,{children:"build"})," then ",(0,r.jsx)(s.code,{children:"test"}),")."]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["See also: Engine internals \u2014 ",(0,r.jsx)(s.a,{href:"/docs/explanations/engine",children:"engine"})]}),"\n",(0,r.jsx)(s.h2,{id:"workflow-docs",children:"Workflow Docs"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Init \u2014 ",(0,r.jsx)(s.a,{href:"/docs/how-to/init",children:"init"})]}),"\n",(0,r.jsxs)(s.li,{children:["Build \u2014 ",(0,r.jsx)(s.a,{href:"/docs/how-to/build",children:"build"})]}),"\n",(0,r.jsxs)(s.li,{children:["Watch \u2014 ",(0,r.jsx)(s.a,{href:"/docs/how-to/watch",children:"watch"})]}),"\n",(0,r.jsxs)(s.li,{children:["Test \u2014 ",(0,r.jsx)(s.a,{href:"/docs/how-to/test",children:"test"})]}),"\n",(0,r.jsxs)(s.li,{children:["Publish \u2014 ",(0,r.jsx)(s.a,{href:"/docs/how-to/publish",children:"publish"})]}),"\n",(0,r.jsxs)(s.li,{children:["Generators \u2014 ",(0,r.jsx)(s.a,{href:"/docs/how-to/add-page",children:"add-page"}),", ",(0,r.jsx)(s.a,{href:"/docs/how-to/add-route",children:"add-route"}),", ",(0,r.jsx)(s.a,{href:"/docs/how-to/add-job",children:"add-job"}),", ",(0,r.jsx)(s.a,{href:"/docs/how-to/add-test",children:"add-test"})]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"how-they-fit-in",children:"How They Fit In"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["CLI selects a workflow (",(0,r.jsx)(s.code,{children:"webstir <command>"}),"), builds an ",(0,r.jsx)(s.code,{children:"AppWorkspace"}),", then invokes the engine."]}),"\n",(0,r.jsx)(s.li,{children:"Workflows call workers (frontend/backend/shared) and pipelines (HTML/CSS/TS) to do the actual work."}),"\n",(0,r.jsxs)(s.li,{children:["Long-running behavior (serving, watching, proxying, reload) is handled by services. See ",(0,r.jsx)(s.a,{href:"/docs/explanations/services",children:"services"})," and ",(0,r.jsx)(s.a,{href:"/docs/explanations/servers",children:"servers"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["All paths and file names come from the workspace and constants. See ",(0,r.jsx)(s.a,{href:"/docs/explanations/workspace",children:"workspace"}),"."]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"workers--di",children:"Workers & DI"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Contracts:","\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"IWorkflowWorker"}),": common worker contract (BuildOrder, InitAsync, BuildAsync, PublishAsync)."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"IFrontendWorker"}),": extends ",(0,r.jsx)(s.code,{children:"IWorkflowWorker"})," with ",(0,r.jsx)(s.code,{children:"AddPageAsync"})," for page scaffolding."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["DI pattern: all workers are registered as ",(0,r.jsx)(s.code,{children:"IWorkflowWorker"})," and workflows inject ",(0,r.jsx)(s.code,{children:"IEnumerable<IWorkflowWorker>"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["Filtering: workflows choose which workers to run based on project mode (client-only, server-only, fullstack). The ",(0,r.jsx)(s.code,{children:"add-page"})," workflow resolves the single ",(0,r.jsx)(s.code,{children:"IFrontendWorker"}),", which now shells out to ",(0,r.jsx)(s.code,{children:"webstir-frontend add-page"})," for scaffolding."]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"initiation",children:"Initiation"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["CLI commands (primary):","\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.code,{children:"webstir init [options] [directory]"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.code,{children:"webstir build [--clean]"})}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"webstir watch"})," (default when no command is provided)"]}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.code,{children:"webstir test"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.code,{children:"webstir publish"})}),"\n",(0,r.jsxs)(s.li,{children:["Generators: ",(0,r.jsx)(s.code,{children:"webstir add-page <name>"}),", ",(0,r.jsx)(s.code,{children:"webstir add-route <name> [--method <METHOD>] [--path <path>] [--fastify]"}),", ",(0,r.jsx)(s.code,{children:"webstir add-job <name> [--schedule <expression>]"}),", ",(0,r.jsx)(s.code,{children:"webstir add-test <name-or-path>"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["Programmatic chaining: workflows may invoke others as steps (e.g., ",(0,r.jsx)(s.code,{children:"watch"})," \u2192 ",(0,r.jsx)(s.code,{children:"build"})," \u2192 ",(0,r.jsx)(s.code,{children:"test"})," \u2192 start services)."]}),"\n",(0,r.jsx)(s.li,{children:"CI usage: run discrete workflows with standard exit codes to gate builds."}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"responsibilities",children:"Responsibilities"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Validate inputs and workspace invariants; fail fast with clear errors."}),"\n",(0,r.jsx)(s.li,{children:"Decide order of operations and which workers/services to involve."}),"\n",(0,r.jsx)(s.li,{children:"Surface concise, actionable logs and return appropriate exit codes."}),"\n",(0,r.jsx)(s.li,{children:"Never hand-roll path strings; use workspace helpers and constants."}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"lifecycle-by-workflow",children:"Lifecycle (By Workflow)"}),"\n",(0,r.jsx)(s.h3,{id:"init",children:"init"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Create a project from embedded templates (frontend, backend, shared, types)."}),"\n",(0,r.jsx)(s.li,{children:"Normalize names/paths; write a ready-to-run structure."}),"\n",(0,r.jsxs)(s.li,{children:["Output: scaffolded source tree under ",(0,r.jsx)(s.code,{children:"src/**"})," plus ",(0,r.jsx)(s.code,{children:"types/"}),"."]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"build",children:"build"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Compile TypeScript with ",(0,r.jsx)(s.code,{children:"tsc --build"}),", then bundle JavaScript with ",(0,r.jsx)(s.strong,{children:"esbuild"})," for fast development builds."]}),"\n",(0,r.jsxs)(s.li,{children:["Process CSS imports and merge page HTML into ",(0,r.jsx)(s.code,{children:"build/"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["Copy Images, Fonts, and Media to ",(0,r.jsx)(s.code,{children:"build/frontend/{images|fonts|media}/**"}),"."]}),"\n",(0,r.jsx)(s.li,{children:"Perform incremental work when possible; keep output readable with source maps in dev."}),"\n",(0,r.jsxs)(s.li,{children:["Output: ",(0,r.jsx)(s.code,{children:"build/frontend/**"}),", ",(0,r.jsx)(s.code,{children:"build/backend/**"}),"."]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"watch",children:"watch"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Run an initial ",(0,r.jsx)(s.code,{children:"build"})," and ",(0,r.jsx)(s.code,{children:"test"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["Start the dev web server and Node API server; begin watching ",(0,r.jsx)(s.code,{children:"src/**"}),"."]}),"\n",(0,r.jsx)(s.li,{children:"On frontend change: rebuild affected assets and notify browsers via SSE reload."}),"\n",(0,r.jsx)(s.li,{children:"On backend change: rebuild backend code and restart the Node process."}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"test",children:"test"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Build (if needed) and execute compiled tests in Node."}),"\n",(0,r.jsxs)(s.li,{children:["Resolve the testing provider from ",(0,r.jsx)(s.code,{children:"webstir.providers.json"})," or ",(0,r.jsx)(s.code,{children:"WEBSTIR_TESTING_PROVIDER"}),", installing overrides when required."]}),"\n",(0,r.jsx)(s.li,{children:"Produce a pass/fail summary with CI-friendly exit codes."}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"publish",children:"publish"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Produce optimized, fingerprinted assets in ",(0,r.jsx)(s.code,{children:"dist/"})," per page."]}),"\n",(0,r.jsxs)(s.li,{children:["Use ",(0,r.jsx)(s.strong,{children:"esbuild"})," to bundle, tree-shake, minify JavaScript, and perform ",(0,r.jsx)(s.strong,{children:"automatic code-splitting"})," with production optimizations."]}),"\n",(0,r.jsxs)(s.li,{children:["esbuild extracts shared dependencies into ",(0,r.jsx)(s.code,{children:"chunks/"})," folder; manages content hashing for entries (",(0,r.jsx)(s.code,{children:"index-<hash>.js"}),") and chunks (",(0,r.jsx)(s.code,{children:"chunks/*-<hash>.js"}),")."]}),"\n",(0,r.jsx)(s.li,{children:"Minify HTML/CSS, remove comments and source maps, and rewrite HTML links using per-page manifests."}),"\n",(0,r.jsxs)(s.li,{children:["Optimize Images and Fonts when tools available, then copy to ",(0,r.jsx)(s.code,{children:"dist/frontend/{images|fonts|media}/**"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["Output: ",(0,r.jsx)(s.code,{children:"dist/frontend/pages/<page>/index.html"}),", ",(0,r.jsx)(s.code,{children:"index-<hash>.js"}),", ",(0,r.jsx)(s.code,{children:"index.<hash>.css"}),", ",(0,r.jsx)(s.code,{children:"manifest.json"}),", plus ",(0,r.jsx)(s.code,{children:"dist/frontend/chunks/*-<hash>.js"}),"."]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"generators",children:"generators"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"add-page <name>"}),": scaffold ",(0,r.jsx)(s.code,{children:"index.html|css|ts"})," under ",(0,r.jsx)(s.code,{children:"src/frontend/pages/<name>/"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"add-route <name> [--method <METHOD>] [--path <path>] [--fastify]"}),": add a route to ",(0,r.jsx)(s.code,{children:"webstir.module.routes"})," and optionally scaffold/register a Fastify handler."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"add-job <name> [--schedule <expression>]"}),": create ",(0,r.jsx)(s.code,{children:"src/backend/jobs/<name>/index.ts"})," and add a jobs manifest entry."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"add-test <name-or-path>"}),": scaffold a ",(0,r.jsx)(s.code,{children:".test.ts"})," in the nearest ",(0,r.jsx)(s.code,{children:"tests/"}),"."]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"contracts--guarantees",children:"Contracts & Guarantees"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Source roots: ",(0,r.jsx)(s.code,{children:"src/frontend/**"}),", ",(0,r.jsx)(s.code,{children:"src/backend/**"}),", ",(0,r.jsx)(s.code,{children:"src/shared/**"}),", ",(0,r.jsx)(s.code,{children:"types/**"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["Dev outputs: ",(0,r.jsx)(s.code,{children:"build/frontend/**"}),", ",(0,r.jsx)(s.code,{children:"build/backend/**"})," (including ",(0,r.jsx)(s.code,{children:"build/frontend/{images|fonts|media}/**"}),")."]}),"\n",(0,r.jsxs)(s.li,{children:["Prod outputs: ",(0,r.jsx)(s.code,{children:"dist/frontend/pages/<page>/**"})," with per-page manifests, ",(0,r.jsx)(s.code,{children:"dist/frontend/chunks/**"})," for shared code, plus static assets under ",(0,r.jsx)(s.code,{children:"dist/frontend/{images|fonts|media}/**"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["Dev server proxies ",(0,r.jsx)(s.code,{children:"/api/*"})," to the Node process during ",(0,r.jsx)(s.code,{children:"watch"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["Base HTML requires ",(0,r.jsx)(s.code,{children:"<main>"})," in ",(0,r.jsx)(s.code,{children:"src/frontend/app/app.html"}),"."]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"errors--exit-codes",children:"Errors & Exit Codes"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Validation failures (missing base HTML, bad flags, TS errors, failing tests) return non-zero exit codes."}),"\n",(0,r.jsx)(s.li,{children:"Logs name the failing stage and file when possible."}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"adding-a-new-workflow",children:"Adding a New Workflow"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Keep it thin: coordinate, don\u2019t implement pipelines in the workflow."}),"\n",(0,r.jsxs)(s.li,{children:["Use ",(0,r.jsx)(s.code,{children:"AppWorkspace"})," and constants; avoid manual path strings."]}),"\n",(0,r.jsx)(s.li,{children:"Compose existing workers/services; prefer small, testable steps."}),"\n",(0,r.jsx)(s.li,{children:"Define clear inputs, outputs, and exit behavior; add E2E tests that lock down the contract."}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"related-docs",children:"Related Docs"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Solution overview \u2014 ",(0,r.jsx)(s.a,{href:"/docs/explanations/solution",children:"solution"})]}),"\n",(0,r.jsxs)(s.li,{children:["Engine internals \u2014 ",(0,r.jsx)(s.a,{href:"/docs/explanations/engine",children:"engine"})]}),"\n",(0,r.jsxs)(s.li,{children:["Services \u2014 ",(0,r.jsx)(s.a,{href:"/docs/explanations/services",children:"services"})]}),"\n",(0,r.jsxs)(s.li,{children:["Servers \u2014 ",(0,r.jsx)(s.a,{href:"/docs/explanations/servers",children:"servers"})]}),"\n",(0,r.jsxs)(s.li,{children:["Workspace & paths \u2014 ",(0,r.jsx)(s.a,{href:"/docs/explanations/workspace",children:"workspace"})]}),"\n",(0,r.jsxs)(s.li,{children:["Testing \u2014 ",(0,r.jsx)(s.a,{href:"/docs/explanations/testing",children:"tests"})," and the ",(0,r.jsx)(s.a,{href:"https://github.com/webstir-io/webstir-dotnet/blob/main/.codex/testing.md",children:"orchestrator testing guide"})]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,d.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>l,x:()=>o});var i=n(6540);const r={},d=i.createContext(r);function l(e){const s=i.useContext(d);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(d.Provider,{value:s},e.children)}}}]);