"use strict";(self.webpackChunkwebstir_portal=self.webpackChunkwebstir_portal||[]).push([[618],{4754:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>c,contentTitle:()=>t,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"how-to/framework-packages","title":"Build Framework Packages","description":"This guide explains how maintainers rebuild the frontend, backend, and testing packages that ship with Webstir.","source":"@site/docs/how-to/framework-packages.md","sourceDirName":"how-to","slug":"/how-to/framework-packages","permalink":"/docs/how-to/framework-packages","draft":false,"unlisted":false,"editUrl":"https://github.com/webstir-io/webstir-portal/edit/main/docs/how-to/framework-packages.md","tags":[],"version":"current","lastUpdatedAt":1761532142000,"frontMatter":{},"sidebar":"howTo","previous":{"title":"Build","permalink":"/docs/how-to/build"},"next":{"title":"Frontend Watch Daemon","permalink":"/docs/how-to/frontend-watch"}}');var i=n(4848),o=n(8453);const a={},t="Build Framework Packages",c={},d=[{value:"Overview",id:"overview",level:2},{value:"Update The Packages",id:"update-the-packages",level:2},{value:"Automate Releases",id:"automate-releases",level:2},{value:"Developer Helpers",id:"developer-helpers",level:2},{value:"Install In A Workspace",id:"install-in-a-workspace",level:2},{value:"Registry Notes",id:"registry-notes",level:2},{value:"Verify Changes",id:"verify-changes",level:2}];function l(e){const r={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"build-framework-packages",children:"Build Framework Packages"})}),"\n",(0,i.jsx)(r.p,{children:"This guide explains how maintainers rebuild the frontend, backend, and testing packages that ship with Webstir."}),"\n",(0,i.jsx)(r.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"Framework/Frontend"}),", ",(0,i.jsx)(r.code,{children:"Framework/Backend"}),", and ",(0,i.jsx)(r.code,{children:"Framework/Testing"})," contain the sources for the published ",(0,i.jsx)(r.code,{children:"@webstir-io/*"})," packages."]}),"\n",(0,i.jsxs)(r.li,{children:["The standalone ",(0,i.jsx)(r.code,{children:"framework"})," console rebuilds those packages, records registry metadata in ",(0,i.jsx)(r.code,{children:"Framework/Packaging/framework-packages.json"}),", and updates ",(0,i.jsx)(r.code,{children:"Engine/Resources/package.json"})," so workspace templates stay in sync."]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"webstir install"})," keeps consuming workspaces aligned with the recorded registry versions by updating ",(0,i.jsx)(r.code,{children:"package.json"})," specifiers and running the configured package manager (pnpm by default) when drift is detected."]}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"update-the-packages",children:"Update The Packages"}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Bump versions"})," \u2013 Run ",(0,i.jsx)(r.code,{children:"dotnet run --project Framework/Framework.csproj -- packages bump"})," (append ",(0,i.jsx)(r.code,{children:"--bump <patch|minor|major>"})," or ",(0,i.jsx)(r.code,{children:"--set-version <x.y.z>"}),"). Add ",(0,i.jsx)(r.code,{children:"--dry-run"})," to preview the next version without touching manifests. The publish workflow invokes the same command automatically."]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Optional diff"})," \u2013 Run ",(0,i.jsx)(r.code,{children:"dotnet run --project Framework/Framework.csproj -- packages diff"})," to compare the current registry metadata with the package sources. A non-zero exit code indicates version, registry specifier, or workspace specifier drift."]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Rebuild packages"})," \u2013 Run ",(0,i.jsx)(r.code,{children:"dotnet run --project Framework/Framework.csproj -- packages sync"})," from the repo root (or invoke the published ",(0,i.jsx)(r.code,{children:"framework"})," binary).","\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["Add ",(0,i.jsx)(r.code,{children:"--frontend"}),", ",(0,i.jsx)(r.code,{children:"--testing"}),", or ",(0,i.jsx)(r.code,{children:"--backend"})," to rebuild a single package."]}),"\n",(0,i.jsxs)(r.li,{children:["The command runs the workspace\u2019s package manager install (",(0,i.jsx)(r.code,{children:"pnpm install --frozen-lockfile"})," by default) and ",(0,i.jsx)(r.code,{children:"npm run build"})," in each package directory, then rewrites ",(0,i.jsx)(r.code,{children:"framework-packages.json"})," and ",(0,i.jsx)(r.code,{children:"Engine/Resources/package.json"})," with the new versions and caret specifiers."]}),"\n",(0,i.jsxs)(r.li,{children:["Set ",(0,i.jsx)(r.code,{children:"WEBSTIR_FRONTEND_REGISTRY_SPEC"}),", ",(0,i.jsx)(r.code,{children:"WEBSTIR_TEST_REGISTRY_SPEC"}),", or ",(0,i.jsx)(r.code,{children:"WEBSTIR_BACKEND_REGISTRY_SPEC"})," before running if you need to override the default ",(0,i.jsx)(r.code,{children:"<name>@<version>"})," registry specifier (for example, to target a dist-tag during validation)."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Verify metadata"})," \u2013 Run ",(0,i.jsx)(r.code,{children:"dotnet run --project Framework/Framework.csproj -- packages verify"})," to confirm that the package sources, manifest entries, template dependencies, and repository state are aligned. The verifier also ensures no legacy tarball assets remain."]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Publish packages"})," \u2013 Run ",(0,i.jsx)(r.code,{children:"dotnet run --project Framework/Framework.csproj -- packages publish"})," to bump versions, rebuild metadata, and publish any missing releases. Add ",(0,i.jsx)(r.code,{children:"--dry-run"})," to preview without touching files or hitting the registry, and pass ",(0,i.jsx)(r.code,{children:"--bump <patch|minor|major>"})," (or ",(0,i.jsx)(r.code,{children:"--set-version <x.y.z>"}),") when you need to override the automatic bump detection. Ensure ",(0,i.jsx)(r.code,{children:"GH_PACKAGES_TOKEN"})," is available before attempting to publish; the command surfaces actionable errors if authentication or ",(0,i.jsx)(r.code,{children:".npmrc"})," configuration is missing."]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Commit artifacts"})," \u2013 Include the updated package sources, lockfiles, ",(0,i.jsx)(r.code,{children:"Framework/Packaging/framework-packages.json"}),", and ",(0,i.jsx)(r.code,{children:"Engine/Resources/package.json"})," in your PR. No tarballs are generated or committed in the registry-only flow."]}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"automate-releases",children:"Automate Releases"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["Trigger the ",(0,i.jsx)(r.strong,{children:"Release"})," workflow in GitHub Actions when you are ready to publish a new build."]}),"\n",(0,i.jsxs)(r.li,{children:["Choose the bump type (patch, minor, or major). With the default ",(0,i.jsx)(r.code,{children:"auto"})," selection, apply a ",(0,i.jsx)(r.code,{children:"release:{patch|minor|major}"})," label to the PR; the workflow picks the highest bump present."]}),"\n",(0,i.jsxs)(r.li,{children:["The workflow:","\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsx)(r.li,{children:"Bumps package manifests and lockfiles."}),"\n",(0,i.jsxs)(r.li,{children:["Runs ",(0,i.jsx)(r.code,{children:"dotnet run --project Framework/Framework.csproj -- packages publish"})," to rebuild metadata and publish any missing versions."]}),"\n",(0,i.jsxs)(r.li,{children:["Commits the updated metadata back to ",(0,i.jsx)(r.code,{children:"main"}),", tags ",(0,i.jsx)(r.code,{children:"vX.Y.Z"}),", and creates the corresponding GitHub release."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(r.li,{children:["Provide ",(0,i.jsx)(r.code,{children:"dry_run: true"})," if you only want to preview the next version without publishing or pushing changes."]}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"developer-helpers",children:"Developer Helpers"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["Run ",(0,i.jsx)(r.code,{children:"dotnet run --project Framework/Framework.csproj -- packages diff"})," to see how the current sources compare to the recorded manifest before touching tracked files."]}),"\n",(0,i.jsxs)(r.li,{children:["Before committing frontend/testing/back-end changes, run ",(0,i.jsx)(r.code,{children:"dotnet run --project Framework/Framework.csproj -- packages sync"})," followed by ",(0,i.jsx)(r.code,{children:"dotnet run --project Framework/Framework.csproj -- packages verify"})," to ensure the metadata and template dependencies are in sync."]}),"\n",(0,i.jsxs)(r.li,{children:["Use ",(0,i.jsx)(r.code,{children:"dotnet run --project Framework/Framework.csproj -- packages bump --dry-run --bump patch"})," to preview the next version without touching files."]}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"install-in-a-workspace",children:"Install In A Workspace"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["Run ",(0,i.jsx)(r.code,{children:"webstir install"})," (or any workflow that calls it) inside a consuming workspace."]}),"\n",(0,i.jsxs)(r.li,{children:["The installer rewrites the workspace ",(0,i.jsx)(r.code,{children:"package.json"})," entries for the framework packages, removes stale caches when necessary, and runs the selected package manager so ",(0,i.jsx)(r.code,{children:"node_modules"})," matches the recorded registry versions."]}),"\n",(0,i.jsxs)(r.li,{children:["Use ",(0,i.jsx)(r.code,{children:"webstir install --dry-run"})," to inspect upcoming changes, or ",(0,i.jsx)(r.code,{children:"webstir install --clean"})," to clear the ",(0,i.jsx)(r.code,{children:".webstir/"})," cache before reinstalling."]}),"\n",(0,i.jsxs)(r.li,{children:["Override the tool for a single run with ",(0,i.jsx)(r.code,{children:"webstir install --package-manager pnpm@9"})," (or ",(0,i.jsx)(r.code,{children:"-m pnpm@9"}),"); omit the version to use the repo\u2019s ",(0,i.jsx)(r.code,{children:"packageManager"})," metadata."]}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"registry-notes",children:"Registry Notes"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["Framework installs now rely on registry packages. Configure ",(0,i.jsx)(r.code,{children:".npmrc"})," with the appropriate registry URL and authentication token (currently ",(0,i.jsx)(r.code,{children:"GH_PACKAGES_TOKEN"})," for GitHub Packages)."]}),"\n",(0,i.jsxs)(r.li,{children:["For Sandbox or CI scenarios, provision the token and ",(0,i.jsx)(r.code,{children:".npmrc"})," before executing ",(0,i.jsx)(r.code,{children:"framework packages publish"})," or ",(0,i.jsx)(r.code,{children:"webstir install"}),"."]}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"verify-changes",children:"Verify Changes"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["Run ",(0,i.jsx)(r.code,{children:"./utilities/scripts/format-build.sh"})," to ensure formatting passes, the solution builds, and frontend tests succeed."]}),"\n",(0,i.jsxs)(r.li,{children:["When package contents change, run ",(0,i.jsx)(r.code,{children:"framework packages sync"})," followed by ",(0,i.jsx)(r.code,{children:"framework packages verify"}),". Run ",(0,i.jsx)(r.code,{children:"framework packages publish --dry-run"})," for an end-to-end preview of the release pipeline without modifying artifacts."]}),"\n",(0,i.jsxs)(r.li,{children:["In a throwaway workspace, run ",(0,i.jsx)(r.code,{children:"webstir install --clean"})," to confirm the packages reinstall from the registry and that the package manager completes without manual intervention."]}),"\n",(0,i.jsxs)(r.li,{children:["Optionally run ",(0,i.jsx)(r.code,{children:"framework packages publish"})," in a dry environment to ensure credentials are configured before the release workflow executes."]}),"\n"]})]})}function h(e={}){const{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>a,x:()=>t});var s=n(6540);const i={},o=s.createContext(i);function a(e){const r=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function t(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(o.Provider,{value:r},e.children)}}}]);