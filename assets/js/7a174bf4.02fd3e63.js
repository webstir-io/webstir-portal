"use strict";(self.webpackChunkwebstir_portal=self.webpackChunkwebstir_portal||[]).push([[5791],{2146:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>t,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"product/plans/framework/packaging","title":"Framework Packaging Plan","description":"Status: completed. This document is retained for historical context; the registry-first approach described here is now the default.","source":"@site/docs/product/plans/framework/packaging.md","sourceDirName":"product/plans/framework","slug":"/product/plans/framework/packaging","permalink":"/docs/product/plans/framework/packaging","draft":false,"unlisted":false,"editUrl":"https://github.com/webstir-io/webstir-portal/edit/main/docs/product/plans/framework/packaging.md","tags":[],"version":"current","lastUpdatedAt":1761532142000,"frontMatter":{},"sidebar":"plans","previous":{"title":"Framework Package Release Automation Plan","permalink":"/docs/product/plans/framework/package-release-automation"},"next":{"title":"Process Runner \u2014 Phased Plan","permalink":"/docs/product/plans/infrastructure/process-runner"}}');var i=r(4848),l=r(8453);const a={},t="Framework Packaging Plan",o={},c=[{value:"Background",id:"background",level:2},{value:"Goals",id:"goals",level:2},{value:"Non-Goals",id:"non-goals",level:2},{value:"Target Architecture",id:"target-architecture",level:2},{value:"Build &amp; Publish",id:"build--publish",level:3},{value:"Installers &amp; CLI Workflows",id:"installers--cli-workflows",level:3},{value:"Auth &amp; Config",id:"auth--config",level:3},{value:"Workstreams",id:"workstreams",level:2},{value:"Migration Notes",id:"migration-notes",level:2}];function d(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"framework-packaging-plan",children:"Framework Packaging Plan"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Status: completed. This document is retained for historical context; the registry-first approach described here is now the default."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"background",children:"Background"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Historically, ",(0,i.jsx)(n.code,{children:"framework packages sync"})," rebuilt tarballs, copied them into ",(0,i.jsx)(n.code,{children:"Framework/out"})," and ",(0,i.jsx)(n.code,{children:"Framework/Resources/tools"}),", and then rewrote ",(0,i.jsx)(n.code,{children:"Framework/out/manifest.json"})," (",(0,i.jsx)(n.code,{children:"Framework/Packaging/PackageBuilder.cs"}),", ",(0,i.jsx)(n.code,{children:"Framework/Commands/PackageConsoleCommand.cs"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["Runtime installers (",(0,i.jsx)(n.code,{children:"Framework/Packaging/FrontendPackageInstaller.cs"}),", ",(0,i.jsx)(n.code,{children:"Framework/Packaging/TestPackageInstaller.cs"}),") read that manifest, copy tarballs into workspace ",(0,i.jsx)(n.code,{children:".webstir"}),", and verify hashes via ",(0,i.jsx)(n.code,{children:"FrameworkPackageRepository"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["CLI helpers (for example, ",(0,i.jsx)(n.code,{children:"utilities/scripts/local-ci.sh"}),") expect ",(0,i.jsx)(n.code,{children:"framework packages verify"})," to confirm the manifest and tarballs match git."]}),"\n",(0,i.jsx)(n.li,{children:"This dual-storage model was designed for offline installs but increases maintenance, adds hash drift failure modes, and confuses contributors who expect a registry-first experience."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"goals",children:"Goals"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Treat the registry as the single distribution channel for ",(0,i.jsx)(n.code,{children:"@webstir-io/*"})," packages."]}),"\n",(0,i.jsx)(n.li,{children:"Simplify the build/publish workflow to mirror standard npm libraries."}),"\n",(0,i.jsx)(n.li,{children:"Reduce repository noise by eliminating committed tarballs and manifests."}),"\n",(0,i.jsx)(n.li,{children:"Improve developer ergonomics with straightforward auth guidance and clearer errors when credentials are missing."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"non-goals",children:"Non-Goals"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Enabling full offline installs after the migration."}),"\n",(0,i.jsx)(n.li,{children:"Redesigning the package contents themselves."}),"\n",(0,i.jsx)(n.li,{children:"Moving to the public npm registry (tracked separately; this plan keeps GitHub Packages until release)."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"target-architecture",children:"Target Architecture"}),"\n",(0,i.jsx)(n.h3,{id:"build--publish",children:"Build & Publish"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"framework packages sync"})," runs the package manager install (",(0,i.jsx)(n.code,{children:"pnpm install --frozen-lockfile"})," by default), ",(0,i.jsx)(n.code,{children:"npm run build"}),", and ",(0,i.jsx)(n.code,{children:"npm pack"})," inside each package workspace (e.g., ",(0,i.jsx)(n.code,{children:"Framework/Frontend"}),", ",(0,i.jsx)(n.code,{children:"Framework/Testing"}),"), returning metadata but leaving the tarball alongside the source."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"framework packages publish"})," pushes the built tarball to a configurable registry URL (default: GitHub Packages) and skips if the version already exists."]}),"\n",(0,i.jsxs)(n.li,{children:["No files are copied into ",(0,i.jsx)(n.code,{children:"Framework/out"})," or ",(0,i.jsx)(n.code,{children:"Framework/Resources/webstir"}),"; no manifest is generated."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"installers--cli-workflows",children:"Installers & CLI Workflows"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"FrontendPackageInstaller"})," and ",(0,i.jsx)(n.code,{children:"TestPackageInstaller"})," always pin the dependency to the registry specifier (falling back to ",(0,i.jsx)(n.code,{children:"package.json"})," versions if none provided)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"PackageSynchronizer"})," determines whether to rerun the package manager install by comparing dependency specifiers and installed versions, not tarball hashes."]}),"\n",(0,i.jsx)(n.li,{children:"If the registry install fails or credentials are missing, the CLI surfaces a clear error with remediation steps (token required, link to docs)."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"auth--config",children:"Auth & Config"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:".npmrc"})," continues to point ",(0,i.jsx)(n.code,{children:"@webstir-io"})," to GitHub Packages and requires ",(0,i.jsx)(n.code,{children:"GH_PACKAGES_TOKEN"})," during the private phase. Corepack users should run ",(0,i.jsx)(n.code,{children:"corepack enable"})," so pnpm is available without a global install."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"PackageBuilder"})," reads the registry URL and access mode from environment variables or CLI flags to ease the eventual switch to npmjs."]}),"\n",(0,i.jsx)(n.li,{children:"Scripts emit friendly warnings when auth variables are unset and skip publish gracefully."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"workstreams",children:"Workstreams"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["Refactor ",(0,i.jsx)(n.code,{children:"PackageBuilder"})," flow"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Remove copies to ",(0,i.jsx)(n.code,{children:"Framework/out"}),"/",(0,i.jsx)(n.code,{children:"Framework/Resources/webstir"})," and the manifest writer."]}),"\n",(0,i.jsx)(n.li,{children:"Simplify result objects to return build metadata and publish status only."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Retire manifest consumers"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Delete ",(0,i.jsx)(n.code,{children:"FrameworkPackageRepository"})," and related manifest parsing."]}),"\n",(0,i.jsx)(n.li,{children:"Rework installers to depend solely on registry specifiers and installed package.json data."}),"\n",(0,i.jsx)(n.li,{children:"Trim hash validation and tarball copying logic."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["Update ",(0,i.jsx)(n.code,{children:"PackageSynchronizer"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Adjust install decision logic to align with the new installer outputs."}),"\n",(0,i.jsxs)(n.li,{children:["Remove references to tarball flags (",(0,i.jsx)(n.code,{children:"TarballUpdated"}),", ",(0,i.jsx)(n.code,{children:"Hash"})," checks) and rely on dependency/ version mismatch detection."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Tooling & script updates"})}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Edit ",(0,i.jsx)(n.code,{children:"utilities/scripts/local-ci.sh"})," and any CI jobs to drop ",(0,i.jsx)(n.code,{children:"framework packages verify"})," and manifest checks."]}),"\n",(0,i.jsxs)(n.li,{children:["Add lightweight publish validation (e.g., ",(0,i.jsx)(n.code,{children:"npm view"}),") when ",(0,i.jsx)(n.code,{children:"framework packages publish"})," runs."]}),"\n",(0,i.jsxs)(n.li,{children:["Rework ",(0,i.jsx)(n.code,{children:".github/workflows/release.yml"})," so releases no longer rely on ",(0,i.jsx)(n.code,{children:"Framework/out"})," tarballs\u2014either stop attaching them or generate fresh archives during the job."]}),"\n"]}),"\n",(0,i.jsxs)(n.ol,{start:"5",children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Asset cleanup"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Delete ",(0,i.jsx)(n.code,{children:"Framework/out/**"}),", ",(0,i.jsx)(n.code,{children:"Framework/Resources/webstir/**"}),", and embedded resource item groups from ",(0,i.jsx)(n.code,{children:"Framework.csproj"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Remove ",(0,i.jsx)(n.code,{children:"Framework/out"})," from ",(0,i.jsx)(n.code,{children:".gitignore"})," once the directory disappears."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Docs & Dev Onboarding"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Update ",(0,i.jsx)(n.code,{children:"docs/how-to/package-synchronization.md"})," and ",(0,i.jsx)(n.code,{children:"docs/how-to/framework-packages.md"})," to describe the registry-first flow and credential requirements."]}),"\n",(0,i.jsxs)(n.li,{children:["Document how to set ",(0,i.jsx)(n.code,{children:"GH_PACKAGES_TOKEN"}),", how publishing works now, and call out the future switch to the public registry."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Testing & rollout"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Add/adjust integration tests to validate installer behavior with registry installs (mock success/failure)."}),"\n",(0,i.jsxs)(n.li,{children:["Run through ",(0,i.jsx)(n.code,{children:"webstir init/install/watch"})," manually with and without valid auth to confirm error messaging."]}),"\n",(0,i.jsx)(n.li,{children:"Communicate the breaking change (registry access now required) and coordinate the release after packages are rebuilt."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"migration-notes",children:"Migration Notes"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Expect PRs to land in the above order to keep diffs reviewable."}),"\n",(0,i.jsx)(n.li,{children:"A transitional milestone can keep the manifest generation behind a feature flag if we need to support both modes briefly, but the goal is to remove it entirely once scripts/docs are updated."}),"\n",(0,i.jsx)(n.li,{children:"When ready to publish publicly, override the registry URL/access mode in one place (environment variable or config file) and update docs accordingly."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>t});var s=r(6540);const i={},l=s.createContext(i);function a(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);