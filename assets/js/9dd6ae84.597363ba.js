"use strict";(self.webpackChunkwebstir_portal=self.webpackChunkwebstir_portal||[]).push([[6500],{8453:(e,s,n)=>{n.d(s,{R:()=>d,x:()=>t});var r=n(6540);const o={},i=r.createContext(o);function d(e){const s=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:d(e.components),r.createElement(i.Provider,{value:s},e.children)}},9977:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>t,default:()=>h,frontMatter:()=>d,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"product/plans/route-job-generators","title":"webstir add-route / add-job requirements","description":"Goal","source":"@site/docs/product/plans/route-job-generators.md","sourceDirName":"product/plans","slug":"/product/plans/route-job-generators","permalink":"/docs/product/plans/route-job-generators","draft":false,"unlisted":false,"editUrl":"https://github.com/webstir-io/webstir-portal/edit/main/docs/product/plans/route-job-generators.md","tags":[],"version":"current","lastUpdatedAt":1762835573000,"frontMatter":{},"sidebar":"plans","previous":{"title":"MCP Integration with Webstir","permalink":"/docs/product/plans/mcp/brainstorming"},"next":{"title":"Tester Architecture Refactor Plan","permalink":"/docs/product/plans/testing/architecture-refactor"}}');var o=n(4848),i=n(8453);const d={},t="webstir add-route / add-job requirements",l={},c=[{value:"Goal",id:"goal",level:2},{value:"Out of Scope",id:"out-of-scope",level:2},{value:"CLI Surface",id:"cli-surface",level:2},{value:"Manifest Mutations",id:"manifest-mutations",level:2},{value:"Metadata capture approach (implemented)",id:"metadata-capture-approach-implemented",level:3},{value:"Flag set",id:"flag-set",level:4},{value:"Implementation notes",id:"implementation-notes",level:4},{value:"Generated Files",id:"generated-files",level:2},{value:"Console Output &amp; Errors",id:"console-output--errors",level:2},{value:"Tests &amp; Validation",id:"tests--validation",level:2},{value:"Open Questions / Follow-ups",id:"open-questions--follow-ups",level:2}];function a(e){const s={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.header,{children:(0,o.jsx)(s.h1,{id:"webstir-add-route--add-job-requirements",children:"webstir add-route / add-job requirements"})}),"\n",(0,o.jsx)(s.h2,{id:"goal",children:"Goal"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"Provide a clear reference for the CLI scaffolding commands before taking on further changes."}),"\n",(0,o.jsx)(s.li,{children:"Capture file outputs, manifest mutations, validation rules, and test coverage so future edits stay compatible."}),"\n"]}),"\n",(0,o.jsx)(s.h2,{id:"out-of-scope",children:"Out of Scope"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"Changing existing templates or manifest schema (tracked in module-contract)."}),"\n",(0,o.jsx)(s.li,{children:"Introducing new scaffolding targets beyond Fastify routes and TypeScript jobs."}),"\n",(0,o.jsx)(s.li,{children:"Refactoring worker orchestration or project discovery."}),"\n"]}),"\n",(0,o.jsx)(s.h2,{id:"cli-surface",children:"CLI Surface"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"webstir add-route <name> [--method <METHOD>] [--path <path>] [--fastify] [--project-name <project>]"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:["Defined in ",(0,o.jsx)(s.code,{children:"webstir-dotnet/CLI/Help.cs:161"}),"; wired via DI in ",(0,o.jsx)(s.code,{children:"webstir-dotnet/CLI/Program.cs:62"}),"."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"--method"})," defaults to ",(0,o.jsx)(s.code,{children:"GET"})," and must be one of ",(0,o.jsx)(s.code,{children:"GET, HEAD, POST, PUT, PATCH, DELETE, OPTIONS"})," (",(0,o.jsx)(s.code,{children:"webstir-dotnet/Engine/Workflows/AddRouteWorkflow.cs:17"}),")."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"--path"})," defaults to ",(0,o.jsx)(s.code,{children:"/api/<name>"})," and gets a leading ",(0,o.jsx)(s.code,{children:"/"})," when omitted (",(0,o.jsx)(s.code,{children:"webstir-dotnet/Engine/Workflows/AddRouteWorkflow.cs:45"}),")."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"--fastify"})," scaffolds a handler file and patches ",(0,o.jsx)(s.code,{children:"server/fastify.ts"})," if present (",(0,o.jsx)(s.code,{children:"webstir-dotnet/Engine/Workflows/AddRouteWorkflow.cs:52"}),")."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"webstir add-job <name> [--schedule <expression>] [--project-name <project>]"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:["Defined in ",(0,o.jsx)(s.code,{children:"webstir-dotnet/CLI/Help.cs:177"}),"; workflow lives in ",(0,o.jsx)(s.code,{children:"webstir-dotnet/Engine/Workflows/AddJobWorkflow.cs:18"}),"."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"--schedule"})," stores an arbitrary cron-like string in the manifest (",(0,o.jsx)(s.code,{children:"webstir-dotnet/Engine/Workflows/AddJobWorkflow.cs:71"}),")."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["Multi-project detection is centralized in ",(0,o.jsx)(s.code,{children:"webstir-dotnet/Engine/Workflows/BaseWorkflow.cs:43"})," so both commands honor ",(0,o.jsx)(s.code,{children:"--project-name"}),"."]}),"\n"]}),"\n",(0,o.jsx)(s.h2,{id:"manifest-mutations",children:"Manifest Mutations"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:["Target: ",(0,o.jsx)(s.code,{children:"<workspace>/<project>/package.json"})," (",(0,o.jsx)(s.code,{children:"webstir-dotnet/Engine/Workflows/AddRouteWorkflow.cs:87"}),", ",(0,o.jsx)(s.code,{children:"webstir-dotnet/Engine/Workflows/AddJobWorkflow.cs:63"}),")."]}),"\n",(0,o.jsxs)(s.li,{children:["Routes: append ",(0,o.jsx)(s.code,{children:"{ name, method, path }"})," unless an entry already exists with the same method+path (",(0,o.jsx)(s.code,{children:"webstir-dotnet/Engine/Workflows/AddRouteWorkflow.cs:101"}),")."]}),"\n",(0,o.jsxs)(s.li,{children:["Jobs: append ",(0,o.jsx)(s.code,{children:"{ name, schedule? }"})," unless an entry with the same name already exists (",(0,o.jsx)(s.code,{children:"webstir-dotnet/Engine/Workflows/AddJobWorkflow.cs:75"}),")."]}),"\n",(0,o.jsxs)(s.li,{children:["Shape aligns with ",(0,o.jsx)(s.code,{children:"module-contract/schema/module-manifest.schema.json:44"})," and ",(0,o.jsx)(s.code,{children:"module-contract/src/index.ts:360"}),"."]}),"\n",(0,o.jsxs)(s.li,{children:["Potential metadata extensions:","\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:["Route shape supports ",(0,o.jsx)(s.code,{children:"summary"}),", ",(0,o.jsx)(s.code,{children:"description"}),", ",(0,o.jsx)(s.code,{children:"tags"}),", ",(0,o.jsx)(s.code,{children:"input"})," (params/query/body/headers), and ",(0,o.jsx)(s.code,{children:"output"})," schemas that generators could pre-seed."]}),"\n",(0,o.jsxs)(s.li,{children:["Job shape supports ",(0,o.jsx)(s.code,{children:"description"})," and ",(0,o.jsx)(s.code,{children:"priority"})," in addition to ",(0,o.jsx)(s.code,{children:"name"}),"/",(0,o.jsx)(s.code,{children:"schedule"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(s.h3,{id:"metadata-capture-approach-implemented",children:"Metadata capture approach (implemented)"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:["CLI remains script-friendly (no interactive prompts) and continues to rely on positional args/flags only (",(0,o.jsx)(s.code,{children:"webstir-dotnet/Engine/Workflows/BaseWorkflow.cs:17"}),")."]}),"\n",(0,o.jsx)(s.li,{children:"Optional metadata flags now populate manifest fields without affecting existing flows."}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"webstir-dotnet/CLI/Help.cs:161"})," lists the new flags; workflows in ",(0,o.jsx)(s.code,{children:"Engine/Workflows/AddRouteWorkflow.cs"})," and ",(0,o.jsx)(s.code,{children:"Engine/Workflows/AddJobWorkflow.cs"})," parse, normalize, and persist them."]}),"\n",(0,o.jsxs)(s.li,{children:["Tests in ",(0,o.jsx)(s.code,{children:"webstir-dotnet/Tester/Workflows/Add/AddWorkflowTests.cs"})," assert manifest outputs for metadata scenarios."]}),"\n"]}),"\n",(0,o.jsx)(s.h4,{id:"flag-set",children:"Flag set"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:["Routes","\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"--summary <text>"})," \u2014 short human-readable summary \u2192 manifest ",(0,o.jsx)(s.code,{children:"summary"}),"."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"--description <text>"})," \u2014 optional longer description \u2192 manifest ",(0,o.jsx)(s.code,{children:"description"}),"."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"--tags tag1,tag2"})," \u2014 comma-separated values trimmed/deduped (stable order) \u2192 manifest ",(0,o.jsx)(s.code,{children:"tags"})," array."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"--params-schema"}),", ",(0,o.jsx)(s.code,{children:"--query-schema"}),", ",(0,o.jsx)(s.code,{children:"--body-schema"}),", ",(0,o.jsx)(s.code,{children:"--headers-schema"})," \u2014 schema references for request slots (",(0,o.jsx)(s.code,{children:"kind:name@source"}),")."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"--response-schema"}),", ",(0,o.jsx)(s.code,{children:"--response-status"}),", ",(0,o.jsx)(s.code,{children:"--response-headers-schema"})," \u2014 describe response body, status, and headers."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["Jobs","\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"--description <text>"})," \u2014 manifest ",(0,o.jsx)(s.code,{children:"description"}),"."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"--priority <number|string>"})," \u2014 manifest ",(0,o.jsx)(s.code,{children:"priority"})," (pass-through, validate numeric when parsable)."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(s.h4,{id:"implementation-notes",children:"Implementation notes"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsx)(s.p,{children:"Tag parsing trims inputs, removes duplicates case-insensitively, and preserves encounter order."}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsx)(s.p,{children:"Priority accepts integers (stored numerically) or fallback strings when non-numeric."}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:["Schema flags use ",(0,o.jsx)(s.code,{children:"kind:name@source"})," syntax (kind defaults to ",(0,o.jsx)(s.code,{children:"zod"}),"; ",(0,o.jsx)(s.code,{children:"source"})," optional) and populate manifest ",(0,o.jsx)(s.code,{children:"input"}),"/",(0,o.jsx)(s.code,{children:"output"})," references."]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:["Schema references follow module-contract expectations (",(0,o.jsx)(s.code,{children:"kind"}),", ",(0,o.jsx)(s.code,{children:"name"}),", optional ",(0,o.jsx)(s.code,{children:"source"}),"). CLI accepts ",(0,o.jsx)(s.code,{children:"kind:name@source"}),", defaulting ",(0,o.jsx)(s.code,{children:"kind"})," to ",(0,o.jsx)(s.code,{children:"zod"})," and omitting ",(0,o.jsx)(s.code,{children:"source"})," when unspecified. Invalid kinds or missing names raise ",(0,o.jsx)(s.code,{children:"ArgumentException"}),"."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(s.h2,{id:"generated-files",children:"Generated Files"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:["Routes (",(0,o.jsx)(s.code,{children:"--fastify"})," only)","\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"src/backend/server/routes/<name>.ts"})," created with a Fastify ",(0,o.jsx)(s.code,{children:"register"})," wrapper (",(0,o.jsx)(s.code,{children:"webstir-dotnet/Engine/Workflows/AddRouteWorkflow.cs:122"}),")."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"src/backend/server/fastify.ts"})," import + registration patch inserted after Fastify bootstrap or health endpoint (",(0,o.jsx)(s.code,{children:"webstir-dotnet/Engine/Workflows/AddRouteWorkflow.cs:156"}),")."]}),"\n",(0,o.jsxs)(s.li,{children:["No files touched when ",(0,o.jsx)(s.code,{children:"--fastify"})," is omitted."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["Jobs","\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"src/backend/jobs/<name>/index.ts"})," with a ",(0,o.jsx)(s.code,{children:"run()"})," export, main guard, and console logging (",(0,o.jsx)(s.code,{children:"webstir-dotnet/Engine/Workflows/AddJobWorkflow.cs:36"}),")."]}),"\n",(0,o.jsxs)(s.li,{children:["Existing job directory causes a hard error before writing (",(0,o.jsx)(s.code,{children:"webstir-dotnet/Engine/Workflows/AddJobWorkflow.cs:30"}),")."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(s.h2,{id:"console-output--errors",children:"Console Output & Errors"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:["Successful route: ",(0,o.jsx)(s.code,{children:"Added route METHOD /path ..."})," (includes Fastify note when applicable) (",(0,o.jsx)(s.code,{children:"webstir-dotnet/Engine/Workflows/AddRouteWorkflow.cs:59"}),")."]}),"\n",(0,o.jsxs)(s.li,{children:["Successful job: ",(0,o.jsx)(s.code,{children:"Created backend job ..."})," with relative path (",(0,o.jsx)(s.code,{children:"webstir-dotnet/Engine/Workflows/AddJobWorkflow.cs:53"}),")."]}),"\n",(0,o.jsxs)(s.li,{children:["Guardrails:","\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:["Missing positional ",(0,o.jsx)(s.code,{children:"<name>"})," throws usage errors (",(0,o.jsx)(s.code,{children:"webstir-dotnet/Engine/Workflows/AddRouteWorkflow.cs:21"}),", ",(0,o.jsx)(s.code,{children:"webstir-dotnet/Engine/Workflows/AddJobWorkflow.cs:20"}),")."]}),"\n",(0,o.jsxs)(s.li,{children:["Invalid HTTP method raises ",(0,o.jsx)(s.code,{children:"ArgumentException"})," with allowed list (",(0,o.jsx)(s.code,{children:"webstir-dotnet/Engine/Workflows/AddRouteWorkflow.cs:40"}),")."]}),"\n",(0,o.jsxs)(s.li,{children:["Invalid job schedules (bad field counts, unsupported macros, illegal characters) trigger immediate errors (",(0,o.jsx)(s.code,{children:"webstir-dotnet/Engine/Workflows/AddJobWorkflow.cs:138"}),")."]}),"\n",(0,o.jsxs)(s.li,{children:["Missing ",(0,o.jsx)(s.code,{children:"package.json"})," or job directory conflicts surface explicit messages (",(0,o.jsx)(s.code,{children:"webstir-dotnet/Engine/Workflows/AddRouteWorkflow.cs:90"}),", ",(0,o.jsx)(s.code,{children:"webstir-dotnet/Engine/Workflows/AddJobWorkflow.cs:30"}),")."]}),"\n",(0,o.jsxs)(s.li,{children:["Multi-project ambiguity handled centrally with actionable guidance (",(0,o.jsx)(s.code,{children:"webstir-dotnet/Engine/Workflows/BaseWorkflow.cs:63"}),")."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(s.h2,{id:"tests--validation",children:"Tests & Validation"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:["Focused coverage in ",(0,o.jsx)(s.code,{children:"webstir-dotnet/Tester/Workflows/Add/AddWorkflowTests.cs"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:["Manifest writes for baseline commands (",(0,o.jsx)(s.code,{children:"webstir-dotnet/Tester/Workflows/Add/AddWorkflowTests.cs:245"}),")."]}),"\n",(0,o.jsxs)(s.li,{children:["Metadata flags for jobs (",(0,o.jsx)(s.code,{children:"webstir-dotnet/Tester/Workflows/Add/AddWorkflowTests.cs:177"}),")."]}),"\n",(0,o.jsxs)(s.li,{children:["Metadata flags for routes (",(0,o.jsx)(s.code,{children:"webstir-dotnet/Tester/Workflows/Add/AddWorkflowTests.cs:358"}),")."]}),"\n",(0,o.jsxs)(s.li,{children:["Fastify scaffolding and import patching (",(0,o.jsx)(s.code,{children:"webstir-dotnet/Tester/Workflows/Add/AddWorkflowTests.cs:245"}),")."]}),"\n",(0,o.jsxs)(s.li,{children:["Help output (now includes metadata flags) (",(0,o.jsx)(s.code,{children:"webstir-dotnet/Tester/Workflows/Add/AddWorkflowTests.cs:294"}),")."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["When iterating, run ",(0,o.jsx)(s.code,{children:"dotnet test Tester/Tester.csproj --filter FullyQualifiedName~AddWorkflowTests"}),"."]}),"\n"]}),"\n",(0,o.jsx)(s.h2,{id:"open-questions--follow-ups",children:"Open Questions / Follow-ups"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"Should route scaffolding support other backends (Express, Hono) or is Fastify the only first-party option?"}),"\n",(0,o.jsx)(s.li,{children:"Sequence schema flag implementation once module-contract exposes helpers."}),"\n",(0,o.jsxs)(s.li,{children:["Document org-wide schema naming/source conventions so CLI help can link to authoritative guidance. \u2705 Done \u2014 see ",(0,o.jsx)(s.code,{children:"module-contract/README.md#schema-references"})," and the CLI reference links."]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,o.jsx)(s,{...e,children:(0,o.jsx)(a,{...e})}):a(e)}}}]);