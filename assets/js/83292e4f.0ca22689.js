"use strict";(self.webpackChunkwebstir_portal=self.webpackChunkwebstir_portal||[]).push([[5358],{7215:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"explanations/pipelines","title":"Pipelines","description":"Build and publish stages for HTML, CSS, JS/TS, and static assets (Images, Fonts, Media). These pipelines run under the Engine and are orchestrated by workflows (build, watch, publish).","source":"@site/docs/explanations/pipelines.md","sourceDirName":"explanations","slug":"/explanations/pipelines","permalink":"/docs/explanations/pipelines","draft":false,"unlisted":false,"editUrl":"https://github.com/webstir-io/webstir-portal/edit/main/docs/explanations/pipelines.md","tags":[],"version":"current","lastUpdatedAt":1762743690000,"frontMatter":{},"sidebar":"explanations","previous":{"title":"Engine","permalink":"/docs/explanations/engine"},"next":{"title":"Servers","permalink":"/docs/explanations/servers"}}');var d=s(4848),l=s(8453);const r={},c="Pipelines",t={},o=[{value:"Goals",id:"goals",level:2},{value:"Modes",id:"modes",level:2},{value:"HTML",id:"html",level:2},{value:"CSS",id:"css",level:2},{value:"JavaScript / TypeScript",id:"javascript--typescript",level:2},{value:"Backend (Node)",id:"backend-node",level:3},{value:"Assets (Images / Fonts / Media)",id:"assets-images--fonts--media",level:2},{value:"Manifests",id:"manifests",level:2},{value:"Outputs",id:"outputs",level:2},{value:"Hooks",id:"hooks",level:2},{value:"Related Docs",id:"related-docs",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"pipelines",children:"Pipelines"})}),"\n",(0,d.jsxs)(n.p,{children:["Build and publish stages for HTML, CSS, JS/TS, and static assets (Images, Fonts, Media). These pipelines run under the Engine and are orchestrated by workflows (",(0,d.jsx)(n.code,{children:"build"}),", ",(0,d.jsx)(n.code,{children:"watch"}),", ",(0,d.jsx)(n.code,{children:"publish"}),")."]}),"\n",(0,d.jsx)(n.h2,{id:"goals",children:"Goals"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Deterministic outputs for given inputs."}),"\n",(0,d.jsx)(n.li,{children:"Fast dev builds; optimized production bundles."}),"\n",(0,d.jsx)(n.li,{children:"Clear errors that name the stage and file."}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"modes",children:"Modes"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Dev (build/watch): readable output in ",(0,d.jsx)(n.code,{children:"build/**"}),", source context preserved, no minification."]}),"\n",(0,d.jsxs)(n.li,{children:["Publish: optimized output in ",(0,d.jsx)(n.code,{children:"dist/**"}),", fingerprinted asset names, HTML rewritten to point at the manifest."]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"html",children:"HTML"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Source: page fragments under ",(0,d.jsx)(n.code,{children:"src/frontend/pages/<page>/index.html"}),"."]}),"\n",(0,d.jsxs)(n.li,{children:["Base template: ",(0,d.jsx)(n.code,{children:"src/frontend/app/app.html"})," must contain a ",(0,d.jsx)(n.code,{children:"<main>"})," placeholder."]}),"\n",(0,d.jsxs)(n.li,{children:["Dev: merge page HTML into the base template \u2192 ",(0,d.jsx)(n.code,{children:"build/frontend/pages/<page>/index.html"}),"."]}),"\n",(0,d.jsxs)(n.li,{children:["Publish: rewrite asset references using the per-page ",(0,d.jsx)(n.code,{children:"manifest.json"}),",\nrun HTML minifier (removes comments, collapses inter-tag whitespace,\nsafe attribute optimizations), and emit precompressed ",(0,d.jsx)(n.code,{children:".html.br"}),"."]}),"\n",(0,d.jsxs)(n.li,{children:["Errors: fail if base HTML is missing or lacks ",(0,d.jsx)(n.code,{children:"<main>"}),"."]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"css",children:"CSS"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Bundler"}),": esbuild handles CSS processing alongside JavaScript for unified pipeline."]}),"\n",(0,d.jsxs)(n.li,{children:["Dev: esbuild bundles with ",(0,d.jsx)(n.code,{children:"--sourcemap"})," for debugging; outputs readable CSS."]}),"\n",(0,d.jsxs)(n.li,{children:["Publish: esbuild minifies CSS with ",(0,d.jsx)(n.code,{children:"--minify"}),"; writes fingerprinted ",(0,d.jsx)(n.code,{children:"index-<hash>.css"}),"."]}),"\n",(0,d.jsxs)(n.li,{children:["Features:","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Automatic ",(0,d.jsx)(n.code,{children:"@import"})," resolution and bundling"]}),"\n",(0,d.jsxs)(n.li,{children:["CSS Modules support via ",(0,d.jsx)(n.code,{children:".module.css"})," extension"]}),"\n",(0,d.jsx)(n.li,{children:"URL rewriting for assets (images, fonts)"}),"\n",(0,d.jsx)(n.li,{children:"Modern CSS syntax support including nesting"}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["esbuild configuration:","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Development: ",(0,d.jsx)(n.code,{children:"--bundle --sourcemap --loader:.css=css"})]}),"\n",(0,d.jsxs)(n.li,{children:["Production: ",(0,d.jsx)(n.code,{children:"--bundle --minify --loader:.css=css --entry-names=[dir]/index-[hash]"})]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["Output paths follow the page layout in ",(0,d.jsx)(n.code,{children:"build/frontend/pages/<page>/"})," and ",(0,d.jsx)(n.code,{children:"dist/frontend/pages/<page>/"}),"."]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"javascript--typescript",children:"JavaScript / TypeScript"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Compiler: ",(0,d.jsx)(n.code,{children:"tsc --build"})," using an embedded base ",(0,d.jsx)(n.code,{children:"tsconfig"})," for type checking."]}),"\n",(0,d.jsxs)(n.li,{children:["Bundler: ",(0,d.jsx)(n.strong,{children:"esbuild"})," for exceptional performance (10-100x faster than traditional bundlers)."]}),"\n",(0,d.jsxs)(n.li,{children:["Dev: produce readable JS with source maps under ",(0,d.jsx)(n.code,{children:"build/frontend/**"}),"; esbuild bundles with ",(0,d.jsx)(n.code,{children:"--sourcemap"}),"."]}),"\n",(0,d.jsxs)(n.li,{children:["Publish: esbuild handles tree-shaking, minification, console stripping, and ",(0,d.jsx)(n.strong,{children:"automatic code-splitting"}),"; write fingerprinted ",(0,d.jsx)(n.code,{children:"index-<hash>.js"})," per page entry."]}),"\n",(0,d.jsxs)(n.li,{children:["Output shape: ESM bundle format, referenced with ",(0,d.jsx)(n.code,{children:'type="module"'})," for modern browser compatibility."]}),"\n",(0,d.jsxs)(n.li,{children:["esbuild configuration:","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Development: ",(0,d.jsx)(n.code,{children:'--bundle --sourcemap --format=esm --define:process.env.NODE_ENV="development"'})]}),"\n",(0,d.jsxs)(n.li,{children:["Production: ",(0,d.jsx)(n.code,{children:'--bundle --minify --format=esm --drop:console --splitting --chunk-names=chunks/[name]-[hash] --entry-names=[dir]/index-[hash] --metafile --define:process.env.NODE_ENV="production"'})]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["Code-splitting (production): Automatically extracts shared dependencies into ",(0,d.jsx)(n.code,{children:"chunks/"})," folder; entry points import chunks via ESM; browser handles chunk loading transparently."]}),"\n",(0,d.jsxs)(n.li,{children:["Content hashing: esbuild manages hashes for both entries and chunks via ",(0,d.jsx)(n.code,{children:"--entry-names"})," and ",(0,d.jsx)(n.code,{children:"--chunk-names"})," patterns."]}),"\n",(0,d.jsxs)(n.li,{children:["Entry points: Automatically discovered from ",(0,d.jsx)(n.code,{children:"build/frontend/pages/*/index.js"})," (tsc output)."]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"backend-node",children:"Backend (Node)"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Source: ",(0,d.jsx)(n.code,{children:"src/backend/**"})," compiled to ",(0,d.jsx)(n.code,{children:"build/backend/**"})," in dev."]}),"\n",(0,d.jsxs)(n.li,{children:["Publish: bundles backend entries with esbuild (ESM, external deps), minifies, and writes to ",(0,d.jsx)(n.code,{children:"dist/backend/**"}),"."]}),"\n",(0,d.jsxs)(n.li,{children:["Sourcemaps (opt\u2011in): set ",(0,d.jsx)(n.code,{children:"WEBSTIR_BACKEND_SOURCEMAPS=on"})," during publish to emit ",(0,d.jsx)(n.code,{children:".map"})," files under ",(0,d.jsx)(n.code,{children:"dist/backend/**"})," and retain a ",(0,d.jsx)(n.code,{children:"//# sourceMappingURL"})," in ",(0,d.jsx)(n.code,{children:"index.js"}),"."]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"assets-images--fonts--media",children:"Assets (Images / Fonts / Media)"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Source folders under ",(0,d.jsx)(n.code,{children:"src/frontend/"}),":","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Images: ",(0,d.jsx)(n.code,{children:"images/**"})," (png, jpg, jpeg, gif, svg, webp, ico)"]}),"\n",(0,d.jsxs)(n.li,{children:["Fonts: ",(0,d.jsx)(n.code,{children:"fonts/**"})," (woff2, woff, ttf, otf, eot, svg)"]}),"\n",(0,d.jsxs)(n.li,{children:["Media: ",(0,d.jsx)(n.code,{children:"media/**"})," (mp3, m4a, wav, ogg, mp4, webm, mov)"]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["Dev: copy to ",(0,d.jsx)(n.code,{children:"build/frontend/{images|fonts|media}/**"}),", preserving structure."]}),"\n",(0,d.jsxs)(n.li,{children:["Publish: optimize and copy to ",(0,d.jsx)(n.code,{children:"dist/frontend/{images|fonts|media}/**"}),".","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Images: ",(0,d.jsx)(n.code,{children:"ImageOptimizer"})," compresses and generates WebP/AVIF variants when tools available."]}),"\n",(0,d.jsxs)(n.li,{children:["Fonts: ",(0,d.jsx)(n.code,{children:"FontOptimizer"})," converts to WOFF2 when possible, enforces ",(0,d.jsx)(n.code,{children:"font-display: swap"}),"."]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.li,{children:"Graceful fallback: optimization tools are optional; originals served if tools unavailable."}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"manifests",children:"Manifests"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["One ",(0,d.jsx)(n.code,{children:"manifest.json"})," per page under ",(0,d.jsx)(n.code,{children:"dist/frontend/pages/<page>/"})," listing fingerprinted assets."]}),"\n",(0,d.jsx)(n.li,{children:"HTML is rewritten in publish to reference manifest entries (stable HTML URLs)."}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"outputs",children:"Outputs"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Dev: ",(0,d.jsx)(n.code,{children:"build/frontend/**"}),", ",(0,d.jsx)(n.code,{children:"build/backend/**"}),"."]}),"\n",(0,d.jsxs)(n.li,{children:["Publish:","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Pages: ",(0,d.jsx)(n.code,{children:"dist/frontend/pages/<page>/index.html"}),", ",(0,d.jsx)(n.code,{children:"index-<hash>.js"}),", ",(0,d.jsx)(n.code,{children:"index.<hash>.css"}),", ",(0,d.jsx)(n.code,{children:"manifest.json"})]}),"\n",(0,d.jsxs)(n.li,{children:["Shared chunks: ",(0,d.jsx)(n.code,{children:"dist/frontend/chunks/*-<hash>.js"})," (vendor libraries, common code)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"hooks",children:"Hooks"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Optional ",(0,d.jsx)(n.code,{children:"webstir.config.js"})," at the workspace root can inject pre/post logic."]}),"\n",(0,d.jsxs)(n.li,{children:["Pipeline hooks: ",(0,d.jsx)(n.code,{children:"beforeAll"}),"/",(0,d.jsx)(n.code,{children:"afterAll"})," around the entire build or publish run."]}),"\n",(0,d.jsxs)(n.li,{children:["Builder hooks: ",(0,d.jsx)(n.code,{children:"before"}),"/",(0,d.jsx)(n.code,{children:"after"})," per stage (",(0,d.jsx)(n.code,{children:"javascript"}),", ",(0,d.jsx)(n.code,{children:"css"}),", ",(0,d.jsx)(n.code,{children:"html"}),", ",(0,d.jsx)(n.code,{children:"static-assets"}),")."]}),"\n",(0,d.jsxs)(n.li,{children:["Handlers receive ",(0,d.jsx)(n.code,{children:"{ config, mode, workspaceRoot, builderName?, changedFile? }"}),"."]}),"\n",(0,d.jsxs)(n.li,{children:["See ",(0,d.jsx)(n.a,{href:"/docs/how-to/pipeline-hooks",children:"Extend Pipelines with Hooks"})," for usage details."]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"related-docs",children:"Related Docs"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Engine internals \u2014 engine.md"}),"\n",(0,d.jsx)(n.li,{children:"Workflows \u2014 ../reference/workflows.md"}),"\n",(0,d.jsx)(n.li,{children:"Servers (dev) \u2014 servers.md"}),"\n",(0,d.jsx)(n.li,{children:"Dev service \u2014 devservice.md"}),"\n",(0,d.jsx)(n.li,{children:"Workspace & paths \u2014 workspace.md"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(a,{...e})}):a(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>c});var i=s(6540);const d={},l=i.createContext(d);function r(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:r(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);